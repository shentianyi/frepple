/* frePPLe 4.0.0 2018-09-05
Copyright (C) 2010-2017 by frePPLe bvba

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

"use strict";function operationplanCtrl(a,b){function c(c,d){var e=[],f={};f.colmodel={};var g=0;angular.forEach(d,function(a,b){a.hasOwnProperty("summaryType")&&(e.push([b,a.name,a.summaryType,a.formatter]),f[a.name]=null,f.colmodel[a.name]={type:a.summaryType,label:a.label})}),angular.forEach(c,function(a){angular.forEach(e,function(b){"sum"===b[2]?isNaN(parseFloat(a[b[1]]))||(null===f[b[1]]?f[b[1]]=parseFloat(a[b[1]]):f[b[1]]+=parseFloat(a[b[1]])):"max"===b[2]?-1!==["color","number","currency"].indexOf(b[3])&&""!==a[b[1]]?parseFloat(a[b[1]])&&(null===f[b[1]]?f[b[1]]=parseFloat(a[b[1]]):f[b[1]]=Math.max(f[b[1]],parseFloat(a[b[1]]))):"duration"===b[3]?(g=new moment.duration(a[b[1]]).asSeconds(),"Invalid Date"!==g._d&&(null===f[b[1]]?f[b[1]]=g:f[b[1]]=Math.max(f[b[1]],g))):"date"===b[3]&&(g=new moment(a[b[1]]),"Invalid Date"!==g._d&&(null===f[b[1]]?f[b[1]]=g:f[b[1]]=moment.max(f[b[1]],g))):"min"===b[2]&&(-1!==["color","number"].indexOf(b[3])&&""!==a[b[1]]?(g=parseFloat(a[b[1]]),isNaN(g)||(null===f[b[1]]?f[b[1]]=g:f[b[1]]=Math.min(f[b[1]],g))):"duration"===b[3]?(g=new moment.duration(a[b[1]]).asSeconds(),"Invalid Date"!==g._d&&(null===f[b[1]]?f[b[1]]=g:f[b[1]]=Math.min(f[b[1]],g))):"date"===b[3]&&(g=new moment(a[b[1]]),"Invalid Date"!==g._d&&(null===f[b[1]]?f[b[1]]=g:f[b[1]]=moment.min(f[b[1]],g))))})}),a.operationplan=new b,f.start=f.startdate,f.end=f.enddate,f.id=-1,f.type=c[0].type,a.$apply(function(){a.operationplan.extend(f)})}function d(c){function d(a){if(void 0===c)return a;void 0!==c.startdate&&""!==c.startdate&&(a.start=c.startdate),void 0!==c.enddate&&""!==c.enddate&&(a.end=c.enddate),void 0!==c.quantity&&""!==c.quantity&&(a.quantity=parseInt(c.quantity)),void 0!==c.status&&""!==c.status&&(a.status=c.status)}var e=void 0===c?void 0:c.id;a.operationplan=new b,void 0!==c&&(c.hasOwnProperty("operationplan__id")?(e=c.operationplan__id,a.operationplan.editable=!1):a.operationplan.editable=!0),a.operationplan.id=void 0===e?void 0:parseInt(e),void 0===a.operationplan.id?a.$apply(function(){a.operationplan=new b}):a.operationplan.get(d)}function e(b){"no_action"!==b&&a.$apply(function(){a.operationplan.status=b})}function f(b,c,d){angular.element(document).find("#"+a.operationplan.id).removeClass("edited").addClass("edited"),void 0!==a.operationplan.id&&b===a.operationplan.id.toString()&&("startdate"===c&&a.$apply(function(){a.operationplan.start=d}),"enddate"===c&&a.$apply(function(){a.operationplan.end=d}),"quantity"===c&&a.$apply(function(){a.operationplan.quantity=parseInt(d)}),"status"===c&&a.refreshstatus(d))}a.test="angular controller",a.operationplan=new b,a.aggregatedopplan=null,a.displayongrid=displayongrid,"function"==typeof a.displayongrid&&a.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.status"],function(b,c){c[0]===b[0]&&-1!==b[0]&&void 0!==c[0]&&(void 0!==c[1]&&void 0!==b[1]&&c[1]!==b[1]&&a.displayongrid(a.operationplan.id,"startdate",a.operationplan.start),void 0!==c[2]&&void 0!==b[2]&&c[2]!==b[2]&&a.displayongrid(a.operationplan.id,"enddate",a.operationplan.end),void 0!==c[3]&&void 0!==b[3]&&c[3]!==b[3]&&a.displayongrid(a.operationplan.id,"quantity",a.operationplan.quantity),void 0!==c[4]&&void 0!==b[4]&&c[4]!==b[4]&&(actions.hasOwnProperty(a.operationplan.status)?a.displayongrid(a.operationplan.id,"status",a.operationplan.status):actions.hasOwnProperty(a.operationplan.status)||"proposed"!==c[4]||actions[Object.keys(actions)[0]]())),c[0]=b[0]}),a.processAggregatedInfo=c,a.displayInfo=d,a.refreshstatus=e,a.displayonpanel=f}function showproblemspanelDrv(a,b){function c(a,c,d){var e='<div class="panel-heading"><strong style="text-transform: capitalize;">'+b.getString("problems")+'</strong></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+b.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("start")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("end")+"</b></td></tr></thead><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.problems.length"],function(c,d){angular.element(document).find("#attributes-operationproblems").empty().append(e);var f='<tr><td colspan="3">'+b.getString("no problems")+"</td></tr>";void 0!==a.operationplan&&a.operationplan.hasOwnProperty("problems")&&(f="",angular.forEach(a.operationplan.problems,function(a){f+="<tr><td>"+a.description+"</td><td>"+a.start+"</td><td>"+a.end+"</td></tr>"})),angular.element(document).find("#attributes-operationproblems tbody").append(f)})}return{restrict:"EA",scope:{operationplan:"=data"},link:c}}function showresourcespanelDrv(a,b){function c(a,c,d){var e='<div class="panel-heading"><strong style="text-transform: capitalize;">'+b.getString("resource")+'</strong></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+b.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("quantity")+"</b></td><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.loadplans.length"],function(c,d){angular.element(document).find("#attributes-operationresources").empty().append(e);var f='<tr><td colspan="2">'+b.getString("no resources")+"</td></tr>";void 0!==a.operationplan&&a.operationplan.hasOwnProperty("loadplans")&&(f="",angular.forEach(a.operationplan.loadplans,function(a){f+="<tr><td>"+a.resource.name+"</td><td>"+a.quantity+"</td></tr>"})),angular.element(document).find("#attributes-operationresources tbody").append(f)})}return{restrict:"EA",scope:{operationplan:"=data"},link:c}}function showbufferspanelDrv(a,b){function c(a,c,d,e){var f='<div class="panel-heading"><strong style="text-transform: capitalize;">'+b.getString("buffer")+'</strong></div><table class="table table-condensed table-hover"><thead style="display: none;"><tr><td><b style="text-transform: capitalize;">'+b.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("quantity")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("expected onhand")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("date")+"</b></td></tr></thead><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.flowplans.length"],function(c,d){angular.element(document).find("#attributes-operationflowplans").empty().append(f);var e='<tr><td colspan="3">'+b.getString("no movements")+"<td></tr>";void 0!==a.operationplan&&a.operationplan.hasOwnProperty("flowplans")&&(e="",angular.forEach(a.operationplan.flowplans,function(a){e+="<tr><td>"+a.buffer.name+"</td><td>"+a.quantity+"</td><td>"+a.onhand+"</td><td>"+a.date+"</td></tr>"}),angular.element(document).find("#attributes-operationflowplans thead").css("display","table-header-group")),angular.element(document).find("#attributes-operationflowplans tbody").append(e)})}return{restrict:"EA",scope:{operationplan:"=data"},link:c}}function showoperationpeggingpanelDrv(a,b){function c(a,c,d,e){var f='<div class="panel-heading"><strong style="text-transform: capitalize;">'+b.getString("demand")+'</strong></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+b.getString("name")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("item")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("due")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("quantity")+"</b></td><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.pegging_demand.length"],function(c,d){angular.element(document).find("#attributes-operationdemandpegging").empty().append(f);var e='<tr><td colspan="2">'+b.getString("no demands")+"</td></tr>";void 0!==a.operationplan&&a.operationplan.hasOwnProperty("pegging_demand")&&(e="",angular.forEach(a.operationplan.pegging_demand,function(a){e+="<tr><td>"+a.demand.name+"</td><td>"+a.demand.item.name+"</td><td>"+a.demand.due+"</td><td>"+a.quantity+"</td></tr>"})),angular.element(document).find("#attributes-operationdemandpegging tbody").append(e)})}return{restrict:"EA",scope:{operationplan:"=data"},link:c}}function showoperationplanDrv(a,b){function c(a,c,d){a.opptype={MO:b.getString("Manufacturing Order"),PO:b.getString("Purchase Order"),DO:b.getString("Distribution Order"),STCK:b.getString("Stock"),DLVR:b.getString("Delivery")},a.$watchGroup(["operationplan.id","operationplan.start","operationplan.end","operationplan.quantity","operationplan.criticality","operationplan.delay","operationplan.status"],function(b,d){if(void 0===a.operationplan.id||isNaN(a.operationplan.id))angular.element(c).find("input").attr("disabled","disabled"),angular.element(c).find("#statusrow .btn").removeClass("active").attr("disabled","disabled"),angular.element(c).find("#setStart").val(""),angular.element(c).find("#setEnd").val("");else{if(void 0===e)var e={};angular.element(c).find("input[disabled]").attr("disabled",!1),e.hasOwnProperty("proposed")&&angular.element(c).find("button[disabled]").attr("disabled",!1),angular.element(c).find("#statusrow .btn").removeClass("active"),a.operationplan.hasOwnProperty("start")&&angular.element(c).find("#setStart").val(moment(a.operationplan.start).format("YYYY-MM-DD HH:mm:ss")),a.operationplan.hasOwnProperty("end")&&angular.element(c).find("#setEnd").val(moment(a.operationplan.end).format("YYYY-MM-DD HH:mm:ss")),a.operationplan.hasOwnProperty("status")&&(angular.element(c).find("#statusrow .btn").removeClass("active"),angular.element(c).find("#"+a.operationplan.status+"Btn").addClass("active"))}a.operationplan.editable||(angular.element(c).find("input").attr("disabled","disabled").css("cursor","default"),angular.element(c).find("#statusrow .btn").attr("disabled","disabled"))}),angular.element(c).find(".vDateField").datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,calendarWeeks:!0,minDate:"2000-01-01",inline:!1,sideBySide:!0,icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"},locale:language,widgetPositioning:{horizontal:"left",vertical:"bottom"}}).on("dp.change",function(b){b.oldDate&&b.date!=b.oldDate&&("setStart"===b.target.id&&a.$apply(function(){a.operationplan.start=new moment(b.date).format("YYYY-MM-DDTHH:mm:ss")}),"setEnd"===b.target.id&&a.$apply(function(){a.operationplan.end=new moment(b.date).format("YYYY-MM-DDTHH:mm:ss")}))}).on("$destroy",function(){void 0!==$(this).data("DateTimePicker")&&$(this).data("DateTimePicker").destroy()})}return{restrict:"EA",scope:{operationplan:"=data"},templateUrl:"/static/operationplandetail/operationplanpanel.html",link:c}}function showsupplyinformationDrv(a,b){function c(a,c,d){var e='<div class="panel-heading"><strong style="text-transform: capitalize;">'+b.getString("supply information")+'</strong></div><div class="table-responsive"><table class="table table-hover table-condensed"><thead><tr><td><b style="text-transform: capitalize;">'+b.getString("priority")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("types")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("origin")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("lead time")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("cost")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("size minimum")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("size multiple")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("effective start")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("effective end")+"</b></td></tr></thead><tbody></tbody></table></div>";a.$watchGroup(["operationplan.id","operationplan.attributes.supply.length"],function(c,d){angular.element(document).find("#attributes-supplyinformation").empty().append(e);var f='<tr><td colspan="9">'+b.getString("no supply information")+"</td></tr>";void 0!==a.operationplan&&a.operationplan.attributes.hasOwnProperty("supply")&&(f="",angular.forEach(a.operationplan.attributes.supply,function(a){f+="<tr>";for(var b in a)f+="<td>",f+=a[b],f+="</td>";f+="</tr>"})),angular.element(document).find("#attributes-supplyinformation tbody").append(f)})}return{restrict:"EA",scope:{operationplan:"=data"},link:c}}function shownetworkstatusDrv(a,b){function c(a,c,d){var e='<div class="panel-heading"><strong style="text-transform: capitalize;">'+b.getString("network status")+'</strong></div><table class="table table-condensed table-hover"><thead><tr><td><b style="text-transform: capitalize;">'+b.getString("item")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("location")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("onhand")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("purchase orders")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("distribution orders")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("manufacturing orders")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("overdue sales orders")+'</b></td><td><b style="text-transform: capitalize;">'+b.getString("sales orders")+"</b></td></tr></thead><tbody></tbody></table>";a.$watchGroup(["operationplan.id","operationplan.network.length"],function(c,d){angular.element(document).find("#attributes-networkstatus").empty().append(e);var f='<tr><td colspan="8">'+b.getString("no network information")+"</td></tr>";void 0!==a.operationplan&&a.operationplan.hasOwnProperty("network")&&(f="",angular.forEach(a.operationplan.network,function(a){f+="<tr><td>"+a[0],!0===a[1]&&(f+="<small>"+b.getString("superseded")+"</small>"),f+="</td><td>"+a[2]+"</td><td>"+a[3]+"</td><td>"+a[4]+"</td><td>"+a[5]+"</td><td>"+a[6]+"</td><td>"+a[7]+"</td><td>"+a[8]+"</td></tr>"})),angular.element(document).find("#attributes-networkstatus tbody").append(f)})}return{restrict:"EA",scope:{operationplan:"=data"},link:c}}var operationplandetailapp=angular.module("operationplandetailapp",["ngCookies","gettext","ngWebSocket","frepple.input","frepple.common"],["$locationProvider",function(a){a.html5Mode({enabled:!0,requireBase:!1})}]);operationplandetailapp.config(["$httpProvider",function(a){a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken"}]),operationplandetailapp.run(["gettextCatalog",function(a){a.setCurrentLanguage(language)}]),operationplandetailapp.filter("formatdate",function(){return function(a){if(void 0!==a)return moment(Date.parse(a)).format("YYYY-MM-DD HH:mm:ss")}}),angular.module("operationplandetailapp").controller("operationplandetailCtrl",operationplanCtrl),operationplanCtrl.$inject=["$scope","OperationPlan"],angular.module("operationplandetailapp").directive("showproblemspanelDrv",showproblemspanelDrv),showproblemspanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showresourcespanelDrv",showresourcespanelDrv),showresourcespanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showbufferspanelDrv",showbufferspanelDrv),showbufferspanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showoperationpeggingpanelDrv",showoperationpeggingpanelDrv),showoperationpeggingpanelDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showoperationplanDrv",showoperationplanDrv),showoperationplanDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("showsupplyinformationDrv",showsupplyinformationDrv),showsupplyinformationDrv.$inject=["$window","gettextCatalog"],angular.module("operationplandetailapp").directive("shownetworkstatusDrv",shownetworkstatusDrv),shownetworkstatusDrv.$inject=["$window","gettextCatalog"];
//# sourceMappingURL=frepple-operationplandetail.min.js.map