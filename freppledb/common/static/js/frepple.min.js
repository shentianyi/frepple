/* frePPLe 4.0.0 2018-08-22
Copyright (C) 2010-2017 by frePPLe bvba

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

function isDragnDropUploadCapable(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&"FormData"in window&&"FileReader"in window}function breadcrumbs_reflow(){var a=$("#breadcrumbs"),b=Math.ceil($("#cockpitcrumb").height())+16;a.children("li:hidden").show();var c=!0;a.children("li").each(function(){a.height()>b&&!c&&$(this).hide(),c=!1})}function admin_escape(a){return a.replace(/_/g,"_5F").replace(/&amp;/g,"_26").replace(/&lt;/g,"_3C").replace(/&gt;/g,"_3E").replace(/&#39;/g,"'").replace(/&quot;/g,"_22").replace(/:/g,"_3A").replace(/\//g,"_2F").replace(/#/g,"_23").replace(/\?/g,"_3F").replace(/;/g,"_3B").replace(/@/g,"_40").replace(/&/g,"_26").replace(/=/g,"_3D").replace(/\+/g,"_2B").replace(/\$/g,"_24").replace(/,/g,"_2C").replace(/"/g,"_22").replace(/</g,"_3C").replace(/>/g,"_3E").replace(/%/g,"_25").replace(/\\/g,"_5C")}function admin_unescape(a){return a.replace(/_5F/g,"_").replace(/_22/g,'"').replace(/_3A/g,":").replace(/_2F/g,"/").replace(/_23/g,"#").replace(/_3F/g,"?").replace(/_3B/g,";").replace(/_40/g,"@").replace(/_26/g,"&").replace(/_3D/g,"=").replace(/_2B/g,"+").replace(/_24/g,"$").replace(/_2C/g,",").replace(/_3C/g,"<").replace(/_3E/g,">").replace(/_25/g,"%").replace(/_5C/g,"\\")}function opendetail(a){var b=$(a.target).parent(),c=b.attr("href"),d=b.attr("objectid");void 0!==d&&0!=d||(d=b.parent().text().trim()),a.preventDefault(),a.stopImmediatePropagation(),window.location.href=url_prefix+c.replace("key",admin_escape(d))}function formatDuration(a,b,c){var d=0,e=0,f=0,g=0,h=1,i=[],j=[];if(void 0===a||""===a||null===a)return"";if("number"==typeof a)g=a,h=Math.sign(g);else switch(h=a.indexOf("-")>-1?-1:1,i=a.replace(/ +/g," ").split(" "),1==i.length?(j=a.split(":"),d=0):(j=i[1].split(":"),d=""!=i[0]?parseFloat(i[0]):0),j.length){case 0:g=86400*Math.abs(d);break;case 1:g=86400*Math.abs(d)+(""!=j[0]?Math.abs(parseFloat(j[0])):0);break;case 2:g=86400*Math.abs(d)+60*(""!=j[0]?Math.abs(parseFloat(j[0])):0)+(""!=j[1]?parseFloat(j[1]):0);break;default:g=86400*Math.abs(d)+3600*(""!=j[0]?Math.abs(parseFloat(j[0])):0)+60*(""!=j[1]?parseFloat(j[1]):0)+(""!=j[2]?parseFloat(j[2]):0)}return g=Math.abs(g),d=Math.floor(g/86400),e=Math.floor((g-86400*d)/3600),f=Math.floor((g-86400*d-3600*e)/60),g=g-86400*d-3600*e-60*f,c.criticality>998?"N/A":d>0?(h*d).toString()+" "+(e<10?"0":"")+e+(f<10?":0":":")+f+(g<10?":0":":")+g.toFixed(g===Math.floor(g)?0:3):(h<0?"-":"")+(e<10?"0":"")+e+(f<10?":0":":")+f+(g<10?":0":":")+g.toFixed(g===Math.floor(g)?0:3)}function getToken(){for(var a=document.cookie.split(";"),b=a.length;b>=0;b--)if(0==jQuery.trim(a[b]).indexOf("csrftoken="))return jQuery.trim(jQuery.trim(a[b]).substr(10));return"none"}function sameOrigin(a){var b=document.location.host,c=document.location.protocol,d="//"+b,e=c+d;return a==e||a.slice(0,e.length+1)==e+"/"||a==d||a.slice(0,d.length+1)==d+"/"||!/^(\/\/|http:|https:).*/.test(a)}function about_show(){$.ajax({url:"/about/",type:"GET",contentType:"application/json",success:function(a){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").modal({keyboard:!1,backdrop:"static"});var b=a.version.split("."),c='<div class="modal-dialog" style="width: 450px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">About frePPLe '+a.version+' Community Edition</h4></div><div class="modal-body"><div class="row">';c+='<div class="col-sm-5"><br><br><p><a target="_blank" href="https://frepple.com/"><strong>frePPLe website &nbsp;<span class="fa fa-caret-right"></span></strong></a></p><br><p><a target="_blank" href="https://frepple.com/docs/'+b[0]+"."+b[1]+'/license.html"><strong>License information &nbsp;<span class="fa fa-caret-right"></span></strong></a></p><br><p><a target="_blank" href="https://frepple.com/docs/'+b[0]+"."+b[1]+'/index.html"><strong>Documentation &nbsp;<span class="fa fa-caret-right"></span></strong></a></p></div><div class="col-sm-7"><strong>'+gettext("Installed apps")+":</strong>";for(var d in a.apps)c+="<br>&nbsp;&nbsp;"+a.apps[d];c+="</div></div></div></div></div>",$("#popup").html(c).modal("show")},error:function(a,b,c){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog style="width: 400px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">About frePPLe '+data.version+'</h4></div><div class="modal-body"><p><h4 class="modal-title alert alert-danger">'+gettext("Error reading version information")+"</h4></p></div></div></div>").modal("show")}})}function import_show(a,b,c,d){var e={abort:function(){}};$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").modal({keyboard:!1,backdrop:"static"});var f='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title"><span id="modal_title">'+gettext("Import CSV or Excel file")+'</span>&nbsp;<span id="animatedcog" class="fa fa-cog fa-spin fa-2x fa-fw" style="visibility: hidden;"></span></h4></div><div class="modal-body"><form id="uploadform"><p id="extra_text">'+gettext("Load an Excel file or a CSV-formatted text file.")+"<br>"+gettext("The first row should contain the field names.")+'<br><br><input type="checkbox" autocomplete="off" name="erase" value="yes"/>&nbsp;&nbsp;'+gettext("First delete all existing records AND ALL RELATED TABLES")+"<br><br></p>";isDragnDropUploadCapable()?f+='<div class="box" style="outline: 2px dashed black; outline-offset: -10px"><div class="box__input" style="text-align: center; padding: 20px;"><i class="fa fa-sign-in fa-5x fa-rotate-90"></i><input class="box__file invisible" type="file" id="csv_file" name="csv_file" data-multiple-caption="{count} '+gettext("files selected")+'" multiple/><label id="uploadlabel" for="csv_file"><kbd>'+gettext("Select files")+'</kbd>&nbsp;<span class="box__dragndrop" style="display: inline;">'+gettext("or drop them here")+'</span>.</label></div><div class="box__uploading" style="display: none;">Uploading&hellip;</div><div class="box__success" style="display: none;">Done!</div><div class="box__error" style="display: none;">Error!<span></span>.</div></div>':f+=gettext("Data file")+':<input type="file" id="csv_file" name="csv_file"/>',f+='</form><br><div style="margin: 5px 0"><div id="uploadResponse" style="height: 50vh; resize: vertical; display: none; background-color: inherit; border: none; overflow: auto;"></div></div></div><div class="modal-footer"><input type="submit" id="importbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Import")+'"><input type="submit" id="cancelimportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Cancel Import")+'" style="display: none;"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Close")+'"><input type="submit" id="copytoclipboard" role="button" class="btn btn-primary pull-left" value="'+gettext("Copy to Clipboard")+'" style="display: none;"></div></div></div>',$("#popup").html(f).modal("show"),c||$("#selected_files").removeAttr(c),""!==a&&$("#modal_title").text(a),null===b?$("#extra_text").remove():""!==b&&$("#extra_text").text(b);var g=!1,h=!1;isDragnDropUploadCapable()&&$(".box").on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault(),a.stopPropagation()}).on("dragover dragenter",function(){$(".box").removeClass("bg-warning").addClass("bg-warning")}).on("dragleave dragend drop",function(){$(".box").removeClass("bg-warning")}).on("drop",function(a){g=c?a.originalEvent.dataTransfer.files:[a.originalEvent.dataTransfer.files[0]],$("#uploadlabel").text(g.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",g.length):g[0].name)}),$("#csv_file").on("change",function(a){h=c?a.target.files:[a.target.files[0]],$("#uploadlabel").text(h.length>1?($("#csv_file").attr("data-multiple-caption")||"").replace("{count}",h.length):h[0].name)}),$("#importbutton").on("click",function(){if(""!==$("#csv_file").val()||g){var a="";$("#uploadResponse").css("display","block"),$("#uploadResponse").html(gettext("Importing...")),$("#uploadResponse").on("scroll",function(){parseInt($("#uploadResponse").attr("data-scrolled"))!==$("#uploadResponse").scrollTop()&&($("#uploadResponse").attr("data-scrolled",!0),$("#uploadResponse").off("scroll"))}),$("#importbutton").hide(),$("#animatedcog").css("visibility","visible"),$("#uploadform").css("display","none"),$("#copytoclipboard").on("click",function(){var a=document.createRange();a.selectNode(document.getElementById("uploadResponse")),window.getSelection().removeAllRanges(),window.getSelection().addRange(a),document.execCommand("copy")}),$("#cancelimportbutton").show().on("click",function(){var a=$("#uploadResponse").clone();a.append("<div><strong>"+gettext("Canceled")+"</strong></div>"),e.abort(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").append(a.contents()),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight),$("#cancelimportbutton").hide(),$("#copytoclipboard").show()}),a=new FormData($("#uploadform")[0]),g&&$.each(g,function(b,c){a.append(c.name,c)}),h&&(a.delete("csv_file"),$.each(h,function(b,c){a.append(c.name,c)})),e=$.ajax(Object.assign({type:"post",url:"undefined"!=typeof url?url:"",cache:!1,data:a,success:function(a){var b=$("#uploadResponse");b.html(a),"true"!==b.attr("data-scrolled")&&b.scrollTop(b[0].scrollHeight-b.height()),$("#cancelbutton").html(gettext("Close")),$("#importbutton").hide(),$("#animatedcog").css("visibility","hidden"),$("#cancelimportbutton").hide(),document.queryCommandSupported("copy")&&$("#copytoclipboard").show(),$("#grid").trigger("reloadGrid")},xhrFields:{onprogress:function(a){var b=$("#uploadResponse");b.html(a.currentTarget.response),"true"!==b.attr("data-scrolled")&&(b.attr("data-scrolled",b[0].scrollHeight-b.height()),b.scrollTop(b[0].scrollHeight-b.height()))}},error:function(){$("#cancelimportbutton").hide(),$("#copytoclipboard").show(),$("#animatedcog").css("visibility","hidden"),$("#uploadResponse").scrollTop($("#uploadResponse")[0].scrollHeight)},processData:!1,contentType:!1},d))}})}function getURLparameters(){if(0==window.location.search.length)return{};var a={};return jQuery.each(window.location.search.match(/^\??(.*)$/)[1].split("&"),function(b,c){c=c.split("="),c[1]=unescape(c[1]).replace(/\+/g," "),a[c[0]]=a[c[0]]?a[c[0]]instanceof Array?(a[c[0]].push(c[1]),a[c[0]]):[a[c[0]],c[1]]:c[1]}),a}function selectDatabase(){var a=$(this).attr("data-database");database!=a&&("default"==database?"/"==window.location.pathname?window.location.href="/"+a+"/":window.location.href=window.location.href.replace(window.location.pathname,"/"+a+window.location.pathname):window.location.href="default"==a?window.location.href.replace("/"+database+"/","/"):window.location.href.replace("/"+database+"/","/"+a+"/"))}function Gauge(a,b){this.placeholderName=a;var c=this;this.configure=function(a){this.config=a,this.config.size=.9*this.config.size,this.config.raduis=.97*this.config.size/2,this.config.cx=this.config.size/2,this.config.cy=this.config.size/2,this.config.min=void 0!=a.min?a.min:0,this.config.max=void 0!=a.max?a.max:100,this.config.range=this.config.max-this.config.min,this.config.majorTicks=a.majorTicks||5,this.config.minorTicks=a.minorTicks||2,this.config.greenColor=a.greenColor||"#109618",this.config.yellowColor=a.yellowColor||"#FF9900",this.config.redColor=a.redColor||"#DC3912",this.config.transitionDuration=a.transitionDuration||500},this.render=function(){this.body=d3.select("#"+this.placeholderName).append("svg:svg").attr("class","gauge").attr("width",this.config.size).attr("height",this.config.size),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",this.config.raduis).style("fill","#ccc").style("stroke","#000").style("stroke-width","0.5px"),this.body.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.9*this.config.raduis).style("fill","#fff").style("stroke","#e0e0e0").style("stroke-width","2px");for(var a in this.config.greenZones)this.drawBand(this.config.greenZones[a].from,this.config.greenZones[a].to,c.config.greenColor);for(var a in this.config.yellowZones)this.drawBand(this.config.yellowZones[a].from,this.config.yellowZones[a].to,c.config.yellowColor);for(var a in this.config.redZones)this.drawBand(this.config.redZones[a].from,this.config.redZones[a].to,c.config.redColor);if(void 0!=this.config.label){var b=Math.round(this.config.size/9);this.body.append("svg:text").attr("x",this.config.cx).attr("y",this.config.cy/2+b/2).attr("dy",b/2).attr("text-anchor","middle").text(this.config.label).style("font-size",b+"px").style("fill","#333").style("stroke-width","0px")}for(var b=Math.round(this.config.size/16),d=this.config.range/(this.config.majorTicks-1),e=this.config.min;e<=this.config.max;e+=d){for(var f=d/this.config.minorTicks,g=e+f;g<Math.min(e+d,this.config.max);g+=f){var h=this.valueToPoint(g,.75),i=this.valueToPoint(g,.85);this.body.append("svg:line").attr("x1",h.x).attr("y1",h.y).attr("x2",i.x).attr("y2",i.y).style("stroke","#666").style("stroke-width","1px")}var h=this.valueToPoint(e,.7),i=this.valueToPoint(e,.85);if(this.body.append("svg:line").attr("x1",h.x).attr("y1",h.y).attr("x2",i.x).attr("y2",i.y).style("stroke","#333").style("stroke-width","2px"),e==this.config.min||e==this.config.max){var j=this.valueToPoint(e,.63);this.body.append("svg:text").attr("x",j.x).attr("y",j.y).attr("dy",b/3).attr("text-anchor",e==this.config.min?"start":"end").text(e).style("font-size",b+"px").style("fill","#333").style("stroke-width","0px")}}var k=this.body.append("svg:g").attr("class","pointerContainer"),l=(this.config.min+this.config.max)/2,m=this.buildPointerPath(l),n=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis");k.selectAll("path").data([m]).enter().append("svg:path").attr("d",n).style("fill","#dc3912").style("stroke","#c63310").style("fill-opacity",.7),k.append("svg:circle").attr("cx",this.config.cx).attr("cy",this.config.cy).attr("r",.12*this.config.raduis).style("fill","#4684EE").style("stroke","#666").style("opacity",1);var b=Math.round(this.config.size/10);k.selectAll("text").data([l]).enter().append("svg:text").attr("x",this.config.cx).attr("y",this.config.size-this.config.cy/4-b).attr("dy",b/2).attr("text-anchor","middle").style("font-size",b+"px").style("fill","#000").style("stroke-width","0px"),this.redraw(this.config.value,0)},this.buildPointerPath=function(a){function b(a,b){var d=c.valueToPoint(a,b);return d.x-=c.config.cx,d.y-=c.config.cy,d}var d=this.config.range/13,e=b(a,.85),f=b(a-d,.12),g=b(a+d,.12),h=a-this.config.range*(1/.75)/2,i=b(h,.28),j=b(h-d,.12);return[e,f,b(h+d,.12),i,j,g,e]},this.drawBand=function(a,b,d){0>=b-a||this.body.append("svg:path").style("fill",d).attr("d",d3.svg.arc().startAngle(this.valueToRadians(a)).endAngle(this.valueToRadians(b)).innerRadius(.65*this.config.raduis).outerRadius(.85*this.config.raduis)).attr("transform",function(){return"translate("+c.config.cx+", "+c.config.cy+") rotate(270)"})},this.redraw=function(a,b){var d=this.body.select(".pointerContainer");d.selectAll("text").text(Math.round(a)),d.selectAll("path").transition().duration(void 0!=b?b:this.config.transitionDuration).attrTween("transform",function(){var b=a;a>c.config.max?b=c.config.max+.02*c.config.range:a<c.config.min&&(b=c.config.min-.02*c.config.range);var d=c.valueToDegrees(b)-90,e=c._currentRotation||d;return c._currentRotation=d,function(a){var b=e+(d-e)*a;return"translate("+c.config.cx+", "+c.config.cy+") rotate("+b+")"}})},this.valueToDegrees=function(a){return a/this.config.range*270-(this.config.min/this.config.range*270+45)},this.valueToRadians=function(a){return this.valueToDegrees(a)*Math.PI/180},this.valueToPoint=function(a,b){return{x:this.config.cx-this.config.raduis*b*Math.cos(this.valueToRadians(a)),y:this.config.cy-this.config.raduis*b*Math.sin(this.valueToRadians(a))}},this.configure(b)}window.__admin_media_prefix__="/static/admin/",$.fn.resizable=function(a){var b={handleSelector:null,resizeWidth:!0,resizeHeight:!0,onDragStart:null,onDragEnd:null,onDrag:null,touchActionNone:!0};return"object"==typeof a&&(b=$.extend(b,a)),this.each(function(){function a(a){a.stopPropagation(),a.preventDefault()}function c(c){g=f(c),g.width=parseInt(i.width(),10),g.height=parseInt(i.height(),10),h=i.css("transition"),i.css("transition","none"),b.onDragStart&&!1===b.onDragStart(c,i,b)||(b.dragFunc=d,$(document).bind("mousemove.rsz",b.dragFunc),$(document).bind("mouseup.rsz",e),(window.Touch||navigator.maxTouchPoints)&&($(document).bind("touchmove.rsz",b.dragFunc),$(document).bind("touchend.rsz",e)),$(document).bind("selectstart.rsz",a))}function d(a){var c=f(a);if(b.resizeWidth){var d=g.width+c.x-g.x;i.width(d)}if(b.resizeHeight){var e=g.height+c.y-g.y;i.height(e)}b.onDrag&&b.onDrag(a,i,b)}function e(c){return c.stopPropagation(),c.preventDefault(),$(document).unbind("mousemove.rsz",b.dragFunc),$(document).unbind("mouseup.rsz",e),(window.Touch||navigator.maxTouchPoints)&&($(document).unbind("touchmove.rsz",b.dragFunc),$(document).unbind("touchend.rsz",e)),$(document).unbind("selectstart.rsz",a),i.css("transition",h),b.onDragEnd&&b.onDragEnd(c,i,b),!1}function f(a){var b={x:0,y:0,width:0,height:0};if("number"==typeof a.clientX)b.x=a.clientX,b.y=a.clientY;else{if(!a.originalEvent.touches)return null;b.x=a.originalEvent.touches[0].clientX,b.y=a.originalEvent.touches[0].clientY}return b}var g,h,i=$(this);if(!$(this).hasClass("ui-jqgrid")){var j=b.handleSelector?$(b.handleSelector):i;b.touchActionNone&&j.css("touch-action","none"),i.addClass("resizable"),j.bind("mousedown.rsz touchstart.rsz",c)}})};var upload={warnUnsavedChanges:function(){return $(window).off("beforeunload",upload.warnUnsavedChanges),gettext("There are unsaved changes on this page.")},undo:function(){$("#undo").hasClass("btn-primary")||($("#grid").trigger("reloadGrid"),$("#grid").closest(".ui-jqgrid-bdiv").scrollTop(0),$("#save, #undo").addClass("btn-primary").removeClass("btn-danger").prop("disabled",!0),$("#actions1").prop("disabled",!0),$("#filter").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges))},select:function(){$("#filter").prop("disabled",!0),$.jgrid.hideModal("#searchmodfbox_grid"),$("#save, #undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$(window).off("beforeunload",upload.warnUnsavedChanges),$(window).on("beforeunload",upload.warnUnsavedChanges)},selectedRows:[],restoreSelection:function(){for(var a in upload.selectedRows)$("#grid").jqGrid("setSelection",upload.selectedRows[a],!1);upload.selectedRows=[]},save:function(){if(!$("#save").hasClass("btn-primary")){if($("#grid").saveCell(editrow,editcol),"function"==typeof getDirtyData)var a=getDirtyData();else var a=$("#grid").getChangedCells("dirty");upload.selectedRows=$("#grid").jqGrid("getGridParam","selarrrow").slice(),null!=a&&a.length>0&&$.ajax({url:location.pathname,data:JSON.stringify(a),type:"POST",contentType:"application/json",success:function(){upload.undo()},error:function(a,b,c){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title alert alert-danger">'+gettext("Error saving data")+'</h4></div><div class="modal-body"><p>'+a.responseText+'</p></div><div class="modal-footer"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Close")+'"></div></div></div>').modal("show")}})}},validateSort:function(a){"grid_cb"!=$(this).attr("id")&&($("body").hasClass("popup")||($("#save").hasClass("btn-primary")?jQuery("#grid").jqGrid("resetSelection"):($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title alert-warning">'+gettext("Save or cancel your changes first")+'</h4></div><div class="modal-body"><p></p></div><div class="modal-footer"><input type="submit" id="savebutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Save")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#savebutton").on("click",function(){upload.save(),$("#popup").modal("hide")}),$("#cancelbutton").on("click",function(){upload.undo(),$("#popup").modal("hide")}),a.stopPropagation())))}};jQuery.extend($.fn.fmatter,{percentage:function(a,b,c){return void 0===a||""===a||null===a?"":a+"%"},duration:formatDuration,admin:function(a,b,c){var d=a+"<a href='/data/"+b.colModel.role+"/key/change/' onclick='opendetail(event)'><span class='leftpadding fa fa-caret-right' role='"+b.colModel.role+"'></span></a>";return void 0===a||""===a||null===a?"":b.colModel.popup||"0"===c.showdrilldown?a:d},detail:function(a,b,c){var d=a+"<a href='/detail/"+b.colModel.role+"/key/' onclick='opendetail(event)'><span class='leftpadding fa fa-caret-right' role='"+b.colModel.role+"'></span></a>";return void 0===a||""===a||null===a?"":b.colModel.popup||"0"===c.showdrilldown?a:!c.hasOwnProperty("type")||"purchase"!==c.type&&"distribution"!==c.type&&"shipping"!==c.type?d:a},demanddetail:function(a,b,c){if(void 0===a||""===a)return"";if(b.colModel.popup)return a;for(var d="",e=a.length,f=0;f<e;f++)""!=d&&(d+=", "),d+=a[f][0]+" : <span>"+a[f][1]+"<a href='/detail/input/demand/key/' onclick='opendetail(event)'><span class='leftpadding fa fa-caret-right' role='input/demand'></span></a></span>";return d},listdetail:function(a,b,c){if(void 0===a||""===a)return"";if(b.colModel.popup)return a;for(var d="",e=a.length,f=0;f<e;f++)""!=d&&(d+=", "),d+="<span>"+a[f][0]+"<a href='/detail/"+b.colModel.role+"/key/' onclick='opendetail(event)'><span class='leftpadding fa fa-caret-right' role='"+b.colModel.role+"'></span></a></span>&nbsp;"+a[f][1];return d},graph:function(a,b,c){return'<div class="graph" style="height:80px"></div>'},longstring:function(a,b,c){if("string"==typeof a){return'<span data-toggle="tooltip" data-placement="left" data-original-title="'+a.replace(/"/g,"'")+'">'+a+"</span>"}return""},color:function(a,b,c){if(void 0===a||""===a)return"";var d=parseInt(a);if(c.inventory_item||c.leadtime){if(!isNaN(d))return d>=100&&d<999999?'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+Math.round(a)+"%</div>":0===d?'<div class="invStatus" style="text-align: center; background-color: #f00; color: #151515;">'+Math.round(a)+"%</div>":999999===d?"":'<div class="invStatus" style="text-align: center; background-color: rgb(255,'+(d=Math.round(d/100*255))+',0); color: #151515;">'+Math.round(a)+"%</div>"}else{var e=Math.round(parseInt(c.delay)/8640)/10;if(999===parseInt(c.criticality)||999===parseInt(c.operationplan__criticality))return'<div class="invStatus" style="text-align: center; background-color: #f00; color: #151515;"></div>';if(e<0)return'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+-e+" "+gettext("days early")+"</div>";if(0===e)return'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+gettext("on time")+"</div>";if(e>0)return d>100?'<div class="invStatus" style="text-align: center; background-color: #f00; color: #151515;">'+e+" "+gettext("days late")+"</div>":d<0?'<div class="invStatus" style="text-align: center; background-color: #008000; color: #151515;">'+e+" "+gettext("days late")+"</div>":'<div class="invStatus" style="text-align: center; background-color: rgb(255,'+Math.round(d/100*255)+',0); color: #151515;">'+e+" "+gettext("days late")+"</div>"}return""}}),jQuery.extend($.fn.fmatter.percentage,{unformat:function(a,b,c){return a}});var grid={selected:void 0,summary_last:function(a,b,c){return c[b]},summary_first:function(a,b,c){return a||c[b]},setSelectedRow:function(a){void 0!=grid.selected&&$(this).jqGrid("setCell",grid.selected,"select",null),grid.selected=a,$(this).jqGrid("setCell",a,"select",'<input type="checkbox" onClick="opener.dismissRelatedLookupPopup(window, grid.selected);" class="btn btn-primary" style="width: 18px; height: 18px;" data-toggle="tooltip" title="'+gettext("Click to select record")+'"></input>')},runAction:function(a){"no_action"!=$("#actions").val()&&actions[$("#actions").val()]()},setStatus:function(a){var b=jQuery("#grid").jqGrid("getGridParam","selarrrow");for(i in b)jQuery("#grid").jqGrid("setCell",b[i],"status",a,"dirty-cell"),jQuery("#grid").jqGrid("setRowData",b[i],!1,"edited");$("#actions1").html($("#actionsul").children().first().text()+'  <span class="caret"></span>'),$("#save").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1),$("#undo").removeClass("btn-primary").addClass("btn-danger").prop("disabled",!1)},pivotcolumns:function(a,b,c){var d="";for(i in cross_idx)""!=d&&(d+="<br>"),cross[cross_idx[i]].editable?d+='<span class="editablepivotcol">'+cross[cross_idx[i]].name+"</span>":d+=cross[cross_idx[i]].name;return d},showCustomize:function(a){var b=$("#grid")[0].p.colModel,c=0,d=0,e=!1,f='<div class="row"><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Selected options")+'</div><div class="panel-body"><ul class="list-group" id="Rows" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Available options")+'</div><div class="panel-body"><ul class="list-group" id="DroppointRows" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>';l="",row2="";var g="",h="",i="",j="";for(var k in b)"graph"==b[k].name?e=!0:"rn"==b[k].name||"cb"==b[k].name||null==b[k].counter||""==b[k].label||"alwayshidden"in b[k]?d++:(b[k].frozen&&(c=parseInt(k,10)+1-d),b[k].hidden?h+='<li id="'+k+'"  class="list-group-item" style="cursor: move;">'+b[k].label+"</li>":g+='<li id="'+k+'"  class="list-group-item" style="cursor: move;">'+b[k].label+"</li>");if(a){var l='<div class="row"><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Selected Cross")+'</div><div class="panel-body"><ul class="list-group" id="Crosses" style="height: 160px; overflow-y: scroll;">placeholder0</ul></div></div></div><div class="col-xs-6"><div class="panel panel-default"><div class="panel-heading">'+gettext("Available Cross")+'</div><div class="panel-body"><ul class="list-group" id="DroppointCrosses" style="height: 160px; overflow-y: scroll;">placeholder1</ul></div></div></div></div>';for(var m in cross_idx)i+='<li class="list-group-item" id="'+(100+parseInt(cross_idx[m],10))+'" style="cursor: move;">'+cross[cross_idx[m]].name+"</li>";for(var m in cross)cross_idx.indexOf(parseInt(m,10))>-1||""==cross[m].name||(j+='<li class="list-group-item" id="'+(100+parseInt(m,10))+'" style="cursor: move;">'+cross[m].name+"</li>")}else row2='<div class="row"><div class="col-xs-12">'+gettext("Frozen columns")+'&nbsp;&nbsp;<input type="number" id="frozen" style="text-align: center;" min="0" max="4" step="1" value="'+c+'"></div></div>';f=f.replace("placeholder0",g),f=f.replace("placeholder1",h),a&&(l=l.replace("placeholder0",i),l=l.replace("placeholder1",j)),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label='+gettext("Close")+'><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+gettext("Customize")+'</h4></div><div class="modal-body">'+f+l+row2+'</div><div class="modal-footer"><input type="submit" id="okCustbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("OK")+'"><input type="submit" id="cancelCustbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" id="resetCustbutton" role="button" class="btn btn-primary pull-right" value="'+gettext("Reset")+'"></div></div></div>').modal("show");var n=document.getElementById("Rows"),o=document.getElementById("DroppointRows");if(Sortable.create(n,{group:{name:"Rows",put:["DroppointRows"]},animation:100}),Sortable.create(o,{group:{name:"DroppointRows",put:["Rows"]},animation:100}),a){var p=document.getElementById("Crosses"),q=document.getElementById("DroppointCrosses");Sortable.create(p,{group:{name:"Crosses",put:["DroppointCrosses"]},animation:100}),Sortable.create(q,{group:{name:"DroppointCrosses",put:["Crosses"]},animation:100})}$("#resetCustbutton").on("click",function(){var a={};if(a[reportkey]=null,"undefined"!=typeof url_prefix)var b=url_prefix+"/settings/";else var b="/settings/";$.ajax({url:b,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),success:function(){window.location.href=window.location.href},error:function(a,b,c){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error retrieving data")+'</h4></div><div class="modal-body"><p>'+a.responseText+"  "+b+c+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})}),$("#okCustbutton").on("click",function(){var b=$("#grid")[0].p.colModel,c=[],d=[];"cb"==b[0].name&&c.push(0),cross_idx=[],e||$("#grid").jqGrid("destroyFrozenColumns"),$("#Rows li").each(function(){val=parseInt(this.id,10),val<100&&($("#grid").jqGrid("showCol",b[val].name),c.push(val))}),$("#DroppointRows li").each(function(){val=parseInt(this.id,10),val<100&&(d.push(val),a&&$("#grid").jqGrid("setColProp",b[val].name,{frozen:!1}),$("#grid").jqGrid("hideCol",b[val].name))}),$("#Crosses li").each(function(){val=parseInt(this.id,10),val>=100&&cross_idx.push(val-100)});var f=0;if(a){for(var g in b)"counter"in b[g]?f=g+1:c.push(parseInt(g,10))}else f=parseInt($("#frozen").val());for(var g in d)c.push(d[g]);$("#grid").jqGrid("remapColumns",c,!0);var h=0;for(var g in b)"rn"!=b[g].name&&"cb"!=b[g].name&&null!=b[g].counter?$("#grid").jqGrid("setColProp",b[g].name,{frozen:g-h<f}):h++;e||$("#grid").jqGrid("setFrozenColumns"),$("#grid").trigger("reloadGrid"),grid.saveColumnConfiguration(),$("#popup").modal("hide")})},saveColumnConfiguration:function(a,b){var c=new Array,d=$("#grid")[0].p.colModel,e=0,f=!1,g=0,h=$("#grid").getGridParam("page");"string"==typeof a?a.indexOf("next")>=0?++h:a.indexOf("prev")>=0?--h:a.indexOf("last")>=0?h=$("#grid").getGridParam("lastpage"):a.indexOf("first")>=0?h=1:a.indexOf("user")>=0&&(h=$("input.ui-pg-input").val()):void 0!==b&&"operationplans"==d[b].name&&gantt.redraw();for(var i in d)"rn"!=d[i].name&&"cb"!=d[i].name&&"counter"in d[i]&&!("alwayshidden"in d[i])?(c.push([d[i].counter,d[i].hidden,d[i].width]),d[i].frozen&&(e=parseInt(i)+1-g)):"columns"==d[i].name||"graph"==d[i].name?f=!0:g++;var j={},k=$("#grid").getGridParam("postData").filters;void 0!==k&&k.rules!=[]?j[reportkey]={rows:c,page:h,filter:k}:j[reportkey]={rows:c,page:h};var l=$("#grid").getGridParam("sortname");if(""!==l&&(j[reportkey].sidx=l,j[reportkey].sord=$("#grid").getGridParam("sortorder")),
f?j[reportkey].crosses=cross_idx:j[reportkey].frozen=e,"function"==typeof extraPreference){var m=extraPreference();for(var n in m)j[reportkey][n]=m[n]}if("undefined"!=typeof url_prefix)var o=url_prefix+"/settings/";else var o="/settings/";$.ajax({url:o,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(j),success:function(){"function"==typeof a&&a()},error:function(a,b,c){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error saving report settings")+'</h4></div><div class="modal-body"><p>'+a.responseText+"  "+b+c+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})},afterEditCell:function(a,b,c,d,e){var f=$(this).jqGrid("getGridParam","colModel")[e];iconslist={time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"},"date"==f.formatter?"Y-m-d"==f.formatoptions.srcformat?$("#"+d+"_"+b).on("focusin",function(){$(this).parent().css({position:"relative",overflow:"visible"}),$(this).datetimepicker({format:"YYYY-MM-DD",useCurrent:!1,calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang,widgetPositioning:{horizontal:"auto",vertical:d<11?"bottom":"auto"}})}):$("#"+d+"_"+b).on("focusin",function(){$(this).parent().css({position:"relative",overflow:"visible"}),$(this).datetimepicker({format:"YYYY-MM-DD HH:mm:ss",useCurrent:!1,calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang,widgetPositioning:{horizontal:"auto",vertical:d<11?"bottom":"auto"}})}):$("#"+d+"_"+b).select()},showExport:function(a){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),a?$("#popup").html('<div class="modal-dialog" style="width: 350px;"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><label class="control-label">'+gettext("Export format")+'<div class="radio" name="csvformat" id="csvformat" value="spreadsheetlist">&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheetlist" checked="">'+gettext("Spreadsheet list")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+'</label><br></div></label></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"):$("#popup").html('<div class="modal-dialog" style="width: 350px;"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">'+gettext("Export CSV or Excel file")+'</h4></div><div class="modal-body"><label class="control-label">'+gettext("Export format")+'<div class="radio" name="csvformat" id="csvformat" value="spreadsheettable">&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheettable" checked="">'+gettext("Spreadsheet table")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="spreadsheetlist">'+gettext("Spreadsheet list")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvtable">'+gettext("CSV table")+'</label><br>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="radio" name="csvformat" value="csvlist">'+gettext("CSV list")+'</label><br></div></label></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#exportbutton").on("click",function(){var a=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;location.search.length>0?a+="&format="+$("#csvformat input:radio:checked").val():"?"==a.charAt(a.length-1)?a+="format="+$("#csvformat input:radio:checked").val():a+="?format="+$("#csvformat input:radio:checked").val();var b=$("#grid").jqGrid("getGridParam","postData");a+="&"+jQuery.param(b),window.open(a,"_blank"),$("#popup").modal("hide")})},showBucket:function(){$("#popup").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),iconslist={time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down",previous:"fa fa-chevron-left",next:"fa fa-chevron-right",today:"fa fa-bullseye",clear:"fa fa-trash",close:"fa fa-remove"},$("#horizonstart").datetimepicker({format:"YYYY-MM-DD",calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang}),$("#horizonend").datetimepicker({format:"YYYY-MM-DD",calendarWeeks:!0,icons:iconslist,locale:document.documentElement.lang}),$("#horizonstart").on("dp.change",function(a){$("#horizonend").data("DateTimePicker").minDate(a.date)}),$("#okbutton").on("click",function(){$("#horizonbuckets").val()+"|"+$("#horizonstart").val()+"|"+$("#horizonend").val()+"|"+($("#horizontype").is(":checked")?"True":"False")+"|"+$("#horizonlength").val()+"|"+$("#horizonunit").val()==$("#horizonoriginal").val()?$("#timebuckets").modal("hide"):($.ajax({type:"POST",url:"/horizon/",data:{horizonbuckets:$("#horizonbuckets").val()?$("#horizonbuckets").val():$("#horizonbucketsul li a").first().text(),horizonstart:$("#horizonstart").val(),horizonend:$("#horizonend").val(),horizontype:$("#horizontype").is(":checked")?"1":"0",horizonlength:$("#horizonlength").val(),horizonunit:$("#horizonunit").val()},dataType:"text/html",async:!1}),window.location.href=window.location.href)}),$("#timebuckets").modal("show")},showDelete:function(){if(!$("#delete_selected").hasClass("disabled")){var a=jQuery("#grid").jqGrid("getGridParam","selarrrow");1==a.length?location.href=location.pathname+encodeURI(a[0])+"/delete/":a.length>0&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Delete data")+'</h4></div><div class="modal-body"><p>'+interpolate(gettext("You are about to delete %s objects AND ALL RELATED RECORDS!"),[a.length],!1)+'</p></div><div class="modal-footer"><input type="submit" id="delbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#delbutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{delete:a}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#copy_selected").prop("disabled",!0).removeClass("bold"),$(".cbox").prop("checked",!1),$("#cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),$("#popup").modal("hide")},error:function(a,b,c){$("#popup .modal-body p").html(a.responseText),$("#popup .modal-title").addClass("alert alert-danger").html(gettext("Error deleting data")),$("#delbutton").prop("disabled",!0).hide()}})}))}},showCopy:function(){if(!$("#copy_selected").hasClass("disabled")){var a=jQuery("#grid").jqGrid("getGridParam","selarrrow");a.length>0&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Copy data")+'</h4></div><div class="modal-body"><p>'+interpolate(gettext("You are about to duplicate %s objects"),[a.length],!1)+'</p></div><div class="modal-footer"><input type="submit" id="copybutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#copybutton").on("click",function(){$.ajax({url:location.pathname,data:JSON.stringify([{copy:a}]),type:"POST",contentType:"application/json",success:function(){$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#copy_selected").prop("disabled",!0).removeClass("bold"),$(".cbox").prop("checked",!1),$("#cb_grid.cbox").prop("checked",!1),$("#grid").trigger("reloadGrid"),$("#popup").modal("hide")},error:function(a,b,c){$("#popup .modal-body p").html(a.responseText),$("#popup .modal-title").addClass("alert alert-danger").html(gettext("Error copying data")),$("#copybutton").prop("disabled",!0).hide()}})}))}},showPlanExportModal:function(){var a={labels:["name","type","quantity","value","startdate","enddate","criticality"],values:[["somename0","atype","1000","1000000","2015-02-31","2016-04-31","1"],["some very long name that almost has no end","atype","1000","1000000","2015-02-31","2016-04-31","1"]]};$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid");var b="",c="";for(i=0;i<a.labels.length;i++)b+="<th>"+gettext(a.labels[i])+"</th>";for(i=0;i<a.values.length;i++){for(c+='<tr><td><input id="cb_modaltable-'+i+'" class="cbox" type="checkbox" aria-checked="false"></td>',j=0;j<a.values[i].length;j++)c+="<td>"+gettext(a.values[i][j])+"</td>";c+="</tr>"}$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Export Plan")+'</h4></div><div class="modal-body"><div class="table-responsive"><table class="table-condensed table-hover" id="forecastexporttable"><thead class="thead-default"><tr><th><input id="cb_modaltableall" class="cbox" type="checkbox" aria-checked="false"></th>'+b+"</tr></thead><tbody><tr>"+c+'</tr></tbody></table></div></div><div class="modal-footer"><input type="submit" id="exportbutton" role="button" class="btn btn-danger pull-left" value="'+gettext("Export")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#exportbutton").on("click",function(){$("#popup").modal("hide")}),$("#cancelbutton").on("click",function(){$("#popup").modal("hide")}),$("#cb_modaltableall").on("click",function(){$("#cb_modaltableall").is(":checked")?($("#forecastexporttable input[type=checkbox]").each(function(){$(this).prop("checked",!0)}),$("#forecastexporttable tr").each(function(){$(this).addClass("selected")})):($("#forecastexporttable input[type=checkbox]").each(function(){$(this).prop("checked",!1)}),$("#forecastexporttable tr.selected").each(function(){$(this).removeClass("selected")}))})},showFilter:function(){$("#filter").hasClass("disabled")||($(".modal").modal("hide"),jQuery("#grid").jqGrid("searchGrid",{closeOnEscape:!0,multipleSearch:!0,multipleGroup:!0,overlay:0,sopt:["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc"],onSearch:function(){grid.saveColumnConfiguration();var a=grid.getFilterGroup(jQuery("#fbox_grid").jqFilter("filterData"),!0);a?($("#curfilter").html(gettext("Filtered where")+" "+a),$("#filter").addClass("btn-danger").removeClass("btn-primary")):($("#filter").removeClass("btn-danger").addClass("btn-primary"),$("#curfilter").html(""))},onReset:function(){return"undefined"!=typeof initialfilter?($("#grid").jqGrid("getGridParam","postData").filters=JSON.stringify(initialfilter),$("#curfilter").html(gettext("Filtered where")+" "+grid.getFilterGroup(initialfilter,!0)),$("#filter").addClass("btn-danger").removeClass("btn-primary")):($("#curfilter").html(""),$("#filter").removeClass("btn-danger").addClass("btn-primary")),grid.saveColumnConfiguration(),!0}}))},getFilterRule:function(a){var b,c,d,e=jQuery("#grid").jqGrid("getGridParam","colModel");for(b=0;b<e.length;b++)if(e[b].name===a.field){c=e[b];break}if(void 0==c)return"";for(var f in $.jgrid.locales)var g=$.jgrid.locales[f].search.odata;for(b=0;b<g.length;b++)if(g[b].oper==a.op){d=g[b].text;break}return void 0==d&&(d=a.op),c.label+" "+d+' "'+a.data+'"'},getFilterGroup:function(a,b){var c,d="";if(b||(d="("),void 0!==a.groups)for(c=0;c<a.groups.length;c++)d.length>1&&("OR"===a.groupOp?d+=" || ":d+=" && "),d+=grid.getFilterGroup(a.groups[c],!1);if(void 0!==a.rules)for(c=0;c<a.rules.length;c++)d.length>1&&("OR"===a.groupOp?d+=" || ":d+=" && "),d+=grid.getFilterRule(a.rules[c]);return b||(d+=")"),"()"===d?"":d},markSelectedRow:function(a){void 0===a&&(a=0),a>0?($("#copy_selected").prop("disabled",!1).addClass("bold"),$("#delete_selected").prop("disabled",!1).addClass("bold"),$("#actions1").prop("disabled",!1)):($("#copy_selected").prop("disabled",!0).removeClass("bold"),$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#actions1").prop("disabled",!0))},markAllRows:function(){$(this).is(":checked")?($("#copy_selected").prop("disabled",!1).addClass("bold"),$("#delete_selected").prop("disabled",!1).addClass("bold"),$("#actions1").prop("disabled",!1),$(".cbox").prop("checked",!0)):($("#copy_selected").prop("disabled",!0).removeClass("bold"),$("#delete_selected").prop("disabled",!0).removeClass("bold"),$("#actions1").prop("disabled",!0),$(".cbox").prop("checked",!1))},displayMode:function(a){var b=-1!=location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):location.href;location.search.length>0?b=b.replace("&mode=table","").replace("&mode=graph","").replace("mode=table","").replace("mode=graph","")+"&mode="+a:"?"==b.charAt(b.length-1)?b+="mode="+a:b+="?mode="+a,window.location.href=b}},wizard={wizdict:{Introduction:{lock:"",rctg:"",cup:"",anchor:"",docanchor:"introductiondoc",url_doc:"/user-guide/modeling-wizard/concepts.html",url_internaldoc:null},"Master data":{lock:"",rctg:"basicdata",cup:"",anchor:"",docanchor:"basicdatadoc",url_doc:"/user-guide/modeling-wizard/master-data/index.html",url_internaldoc:null},Items:{lock:"",rctg:"items",cup:"",anchor:"itemsurl",docanchor:"itemsdoc",url_doc:"/user-guide/modeling-wizard/master-data/items.html",url_internaldoc:"/data/input/item/"},Locations:{lock:"",rctg:"locations",cup:"",anchor:"locationsurl",docanchor:"locationsdoc",url_doc:"/user-guide/modeling-wizard/master-data/locations.html",url_internaldoc:"/data/input/location/"},Customers:{lock:"",rctg:"customers",cup:"",anchor:"customersurl",docanchor:"customersdoc",url_doc:"/user-guide/modeling-wizard/master-data/customers.html",url_internaldoc:"/data/input/customer/"},"Sales orders":{lock:"lock0",rctg:"salesorders",cup:"",anchor:"salesordersurl",docanchor:"salesordersdoc",url_doc:"/user-guide/modeling-wizard/master-data/sales-orders.html",url_internaldoc:"/data/input/demand/"},Buffers:{lock:"lock10",rctg:"buffers",cup:"",anchor:"bufferssurl",docanchor:"bufferssdoc",url_doc:"/user-guide/modeling-wizard/master-data/buffers.html",url_internaldoc:"/data/input/buffer/"},"Sales orders history":{lock:"lock1",rctg:"salesordershistory",cup:"",anchor:"salesordershistoryurl",docanchor:"salesordershistorydoc",url_doc:"/user-guide/modeling-wizard/master-data/sales-orders.html",url_internaldoc:"/data/input/demand/"},"Statistical Forecast":{lock:"",rctg:"statisticalforecast",cup:"cup0",anchor:"statisticalforecasturl",docanchor:"statisticalforecastdoc",url_doc:"/user-guide/model-reference/forecast.html",url_internaldoc:"/forecast/"},"Inventory Planning":{lock:"",rctg:"inventoryplanning",cup:"",anchor:"",docanchor:""},"Inventory Plan Parameters":{lock:"lock2",rctg:"inventoryplanparameters",cup:"",anchor:"inventoryplanparametersurl",docanchor:"inventoryplanparametersdoc",url_doc:"/user-guide/modeling-wizard/inventory-planning/inventory-planning-parameters.html",url_internaldoc:"/data/inventoryplanning/inventoryplanning/"},"Safety Stock":{lock:"",rctg:"safetystock",cup:"cup1",anchor:"safetystockurl",docanchor:"safetystockdoc",url_doc:"/user-guide/modeling-wizard/generate-plan.html",url_internaldoc:"/flowplan/"},"Supply Path":{lock:"",rctg:"supplypath",cup:"",anchor:"",docanchor:""},Purchasing:{lock:"",rctg:"purchasing",cup:"",anchor:"",docanchor:"purchaseordersdoc",url_doc:"/user-guide/modeling-wizard/purchasing/index.html",url_internaldoc:null},Suppliers:{lock:"lock3",rctg:"suppliers",cup:"",anchor:"suppliersurl",docanchor:"suppliersdoc",url_doc:"/user-guide/modeling-wizard/purchasing/suppliers.html",url_internaldoc:"/data/input/supplier/"},"Item suppliers":{lock:"lock4",rctg:"itemsuppliers",cup:"",anchor:"itemsuppliersurl",docanchor:"itemsuppliersdoc",url_doc:"/user-guide/modeling-wizard/purchasing/item-suppliers.html",url_internaldoc:"/data/input/itemsupplier/"},Distribution:{lock:"",rctg:"distribution",cup:"",anchor:"",docanchor:"distributionordersdoc",url_doc:"/user-guide/modeling-wizard/distribution/index.html",url_internaldoc:null},"Item distributions":{lock:"lock5",rctg:"itemdistributions",cup:"",anchor:"itemdistributionsurl",docanchor:"itemdistributionsdoc",url_doc:"/user-guide/modeling-wizard/distribution/item-distributions.html",url_internaldoc:"/data/input/itemdistribution/"},"Manufacturing BOM":{lock:"",rctg:"manufacturingbom",cup:"",anchor:"",docanchor:"manufacturingordersdoc",url_doc:"/user-guide/modeling-wizard/manufacturing-bom/index.html",url_internaldoc:null},Operations:{lock:"lock6",rctg:"operations",cup:"",anchor:"operationsurl",docanchor:"operationsdoc",url_doc:"/user-guide/modeling-wizard/manufacturing-bom/operations.html",url_internaldoc:"/data/input/operation/"},"Operation materials":{lock:"lock7",rctg:"operationmaterials",cup:"",anchor:"operationmaterialsurl",docanchor:"operationmaterialsdoc",url_doc:"/user-guide/modeling-wizard/manufacturing-bom/operation-materials.html",url_internaldoc:"/data/input/operationmaterial/"},"Manufacturing Capacity":{lock:"",rctg:"capacityplanning",cup:"",anchor:"",docanchor:"capacityplanningdoc",url_doc:"/user-guide/modeling-wizard/manufacturing-capacity/index.html",url_internaldoc:null},Resources:{lock:"lock8",rctg:"resources",cup:"",anchor:"resourcesurl",docanchor:"resourcesdoc",url_doc:"/user-guide/modeling-wizard/manufacturing-capacity/resources.html",url_internaldoc:"/data/input/resource/"},"Operation Resources":{lock:"lock9",rctg:"operationresources",cup:"",anchor:"operationresourcesurl",docanchor:"operationresourcesdoc",url_doc:"/user-guide/modeling-wizard/manufacturing-capacity/operation-resources.html",url_internaldoc:"/data/input/operationresource/"},"Plan generation":{lock:"",rctg:"generateplan",cup:"",anchor:"generateplanurl",docanchor:"generateplandoc",url_doc:"/user-guide/modeling-wizard/generate-plan.html",url_internaldoc:""},"Distribution orders":{lock:"",rctg:"plan_do",cup:"cup2",anchor:"plan_dourl",docanchor:"plan_dodoc",url_doc:"/user-guide/modeling-wizard/distribution/distribution-orders.html",url_internaldoc:"/data/input/distributionorder/"},"Purchase orders":{lock:"",rctg:"plan_po",cup:"cup3",anchor:"plan_pourl",docanchor:"plan_podoc",url_doc:"/user-guide/modeling-wizard/purchasing/purchase-orders.html",url_internaldoc:"/data/input/purchaseorder/"},"Manufacturing orders":{lock:"",rctg:"plan_mo",cup:"cup4",anchor:"plan_mourl",docanchor:"plan_modoc",url_doc:"/user-guide/modeling-wizard/manufacturing-bom/manufacturing-orders.html",url_internaldoc:"/data/input/manufacturingorder/"}},removelock:function(a){""!==a.lock&&(document.getElementById(a.lock).style.display="none"),""===a.cup&&""!==a.anchor&&"generateplan"!==document.getElementById(a.rctg).getAttribute("id")&&(document.getElementById(a.rctg).style.fill="cyan"),""!==a.anchor&&(document.getElementById(a.anchor).children[0].style.fill="black",document.getElementById(a.anchor).children[0].style.stroke="none"),document.getElementById(a.rctg).style.stroke="#00d5ff"},turngreen:function(a){document.getElementById(a.rctg).style.stroke="rgb(16, 150, 24)",""!==a.cup?(document.getElementById(a.cup).children[0].style.fill="#ffbf05",document.getElementById(a.cup).children[0].style.stroke="#ffa000",document.getElementById(a.cup).children[1].style.stroke="#ffa000",document.getElementById(a.cup).children[2].style.stroke="#ffa000"):""!==a.anchor&&"generateplan"!==document.getElementById(a.rctg).getAttribute("id")&&(document.getElementById(a.rctg).style.fill="#a4d070")},isPopulated:function(a){if(""===a.anchor||null===a.anchor)return null;var b=document.getElementById(a.anchor).getAttribute("href");return result=$("#nav-menu a[href='"+b+"']").attr("data-populated"),"undefined"==typeof result?null:"True"===result},updateWizard:function(){hasForecast&&(document.getElementById(wizard.wizdict["Sales orders history"].rctg).parentElement.style.display="block",document.getElementById(wizard.wizdict["Statistical Forecast"].rctg).parentElement.style.display="block",document.getElementById(wizard.wizdict["Inventory Planning"].rctg).parentElement.style.display="block",document.getElementById(wizard.wizdict["Safety Stock"].rctg).parentElement.style.display="block",document.getElementById("basictosales").style.display="block",document.getElementById("salestoforecast").style.display="block",document.getElementById("forecasttoinventory").style.display="block",document.getElementById("inventorytostock").style.display="block"),hasIP&&(document.getElementById(wizard.wizdict["Inventory Planning"].rctg).parentElement.style.display="block",document.getElementById(wizard.wizdict["Safety Stock"].rctg).parentElement.style.display="block",document.getElementById("forecasttoinventory").style.display="block",document.getElementById("inventorytostock").style.display="block");var a=["Master data","Distribution","Purchasing","Manufacturing BOM","Manufacturing Capacity"];for(var b in wizard.wizdict)-1!==a.indexOf(b)&&(document.getElementById(wizard.wizdict[b].docanchor).style.display="none"),""!==wizard.wizdict[b].anchor&&null!==wizard.wizdict[b].url_internaldoc&&document.getElementById(wizard.wizdict[b].anchor).setAttribute("href",url_prefix+wizard.wizdict[b].url_internaldoc),""!==wizard.wizdict[b].docanchor&&null!==wizard.wizdict[b].url_doc&&document.getElementById(wizard.wizdict[b].docanchor).setAttribute("href","https://frepple.com/docs/"+version.replace(".beta","")+wizard.wizdict[b].url_doc),"Sales orders"===b&&(document.getElementById(wizard.wizdict["Sales orders history"].anchor).setAttribute("href",url_prefix+wizard.wizdict[b].url_internaldoc),document.getElementById(wizard.wizdict["Sales orders history"].docanchor).setAttribute("href","https://frepple.com/docs/"+version.replace(".beta","")+wizard.wizdict[b].url_doc));$.each(wizard.wizdict,function(a,b){!1===wizard.isPopulated(b)?wizard.removelock(b):wizard.isPopulated(b)&&(wizard.removelock(b),wizard.turngreen(b))}),wizard.isPopulated(wizard.wizdict["Sales orders"])&&(wizard.turngreen(wizard.wizdict["Master data"]),wizard.removelock(wizard.wizdict["Sales orders history"]),wizard.turngreen(wizard.wizdict["Sales orders history"]),wizard.removelock(wizard.wizdict["Statistical Forecast"]),wizard.removelock(wizard.wizdict["Supply Path"]),wizard.removelock(wizard.wizdict.Purchasing),wizard.removelock(wizard.wizdict.Distribution),wizard.removelock(wizard.wizdict["Manufacturing BOM"])),!1===wizard.isPopulated(wizard.wizdict.Suppliers)&&wizard.removelock(wizard.wizdict.Purchasing),wizard.isPopulated(wizard.wizdict["Item suppliers"])&&wizard.turngreen(wizard.wizdict.Purchasing),wizard.isPopulated(wizard.wizdict["Item distributions"])&&wizard.turngreen(wizard.wizdict.Distribution),!1===wizard.isPopulated(wizard.wizdict["Operation materials"])&&wizard.removelock(wizard.wizdict["Manufacturing BOM"]),wizard.isPopulated(wizard.wizdict["Operation materials"])&&wizard.turngreen(wizard.wizdict["Manufacturing BOM"]),wizard.isPopulated(wizard.wizdict["Item suppliers"])&&wizard.isPopulated(wizard.wizdict["Item distributions"])&&wizard.isPopulated(wizard.wizdict["Operation materials"])&&wizard.turngreen(wizard.wizdict["Supply Path"]),!1!==wizard.isPopulated(wizard.wizdict.Resources)&&null===wizard.isPopulated(wizard.wizdict.Operations)||wizard.removelock(wizard.wizdict["Manufacturing Capacity"]),wizard.isPopulated(wizard.wizdict["Operation Resources"])&&wizard.turngreen(wizard.wizdict["Manufacturing Capacity"]),!1!==wizard.isPopulated(wizard.wizdict["Item suppliers"])&&!1!==wizard.isPopulated(wizard.wizdict["Item distributions"])&&!1!==wizard.isPopulated(wizard.wizdict["Operation materials"])||wizard.removelock(wizard.wizdict["Plan generation"]),!0!==wizard.isPopulated(wizard.wizdict["Manufacturing orders"])&&!0!==wizard.isPopulated(wizard.wizdict["Distribution orders"])&&!0!==wizard.isPopulated(wizard.wizdict["Manufacturing orders"])||wizard.turngreen(wizard.wizdict["Plan generation"]),wizard.isPopulated(wizard.wizdict["Statistical Forecast"])&&wizard.turngreen(wizard.wizdict["Statistical Forecast"]),!1===wizard.isPopulated(wizard.wizdict["Inventory Plan Parameters"])&&(wizard.removelock(wizard.wizdict["Inventory Planning"]),wizard.removelock(wizard.wizdict["Inventory Plan Parameters"])),!0===wizard.isPopulated(wizard.wizdict["Inventory Plan Parameters"])&&(wizard.turngreen(wizard.wizdict["Inventory Planning"]),wizard.turngreen(wizard.wizdict["Inventory Plan Parameters"]),wizard.removelock(wizard.wizdict["Safety Stock"])),wizard.isPopulated(wizard.wizdict["Safety Stock"])&&wizard.turngreen(wizard.wizdict["Safety Stock"])}},ERPconnection={IncrementalExport:function(a,b){var c=a.jqGrid("getGridParam","selarrrow");if(null!==c&&0!=c.length){var d=[];for(var e in c){var f=a.jqGrid("getRowData",c[e]);void 0===f.type&&(f.type=b),"proposed"==f.status&&d.push(f)}d!=[]&&($("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize">'+gettext("export")+'</h4></div><div class="modal-body"><p class="text-capitalize">'+gettext("export selected records")+'</p></div><div class="modal-footer"><input type="submit" id="button_export" role="button" class="btn btn-danger pull-left" value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>').modal("show"),$("#button_export").on("click",function(){$("#popup .modal-body p").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(d),type:"POST",contentType:"application/json",success:function(){var b=[];$("#popup .modal-body p").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").removeClass("btn-primary").prop("disabled",!0);for(var d in c){"proposed"===a.jqGrid("getCell",c[d],"status")&&(a.jqGrid("setCell",c[d],"status","approved"),b=a.jqGrid("getRowData",c[d]),b.status="approved")}a.jqGrid("setRowData",b),"function"==typeof checkrows&&checkrows(a,c)},error:function(a,b,c){fmts=ngettext("Error during export"),$("#popup .modal-title").addClass("alert alert-danger").html(gettext("Error during export")),$("#popup .modal-body p").html(gettext("Error during export")+":"+a.responseText),$("#button_export").text(gettext("retry"))}})}),$("#actions1").html($("#actionsul").children().first().text()+'  <span class="caret"></span>'))}},SODepExport:function(a,b){var c=a.jqGrid("getGridParam","selarrrow");if(null!==c&&0!=c.length){var d=[];for(var e in c){var f=a.jqGrid("getRowData",c[e]);void 0===f.type&&(f.type=b),d.push(f)}if(d!=[]){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").html('<div class="modal-dialog" style="max-height: 80%; width: 90%; visibility: hidden"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title text-capitalize">'+gettext("export")+'</h4></div><div class="modal-body"></div><div class="modal-footer"><input type="submit" id="button_export" role="button" class="btn btn-danger pull-left" disabled value="'+gettext("Confirm")+'"><input type="submit" id="cancelbutton" role="button" class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"></div></div></div>');var g="?demand=";for(e=0;e<c.length;e++){var f=a.jqGrid("getRowData",c[e]);void 0===f.type&&(f.type=b),"open"!=f.status&&"proposed"!=f.status||(g+=0==e?encodeURIComponent(c[e]):"&demand="+encodeURIComponent(c[e]))}$.ajax({url:url_prefix+"/demand/operationplans/"+g,type:"GET",contentType:"application/json",success:function(d){$("#popup .modal-body").html('<div class="table-responsive"><table class="table-condensed table-hover" id="forecastexporttable"><thead class="thead-default"></thead></table></div>'),labels=["id","type","item","value","quantity","location","origin","startdate","enddate","criticality"];if("SO"==b){var f=$("<tr/>");for(f.append($("<th/>").html('<input id="cb_modaltableall" class="cbox" type="checkbox" aria-checked="false">')),e=0;e<labels.length;e++)f.append($("<th/>").addClass("text-capitalize").text(gettext(labels[e])));var g=$("<tbody/>");for(e=0;e<d.length;e++){var h=$("<tr/>"),i=$("<td/>");for(i.append($("<input/>").attr({id:"cb_modaltable-"+e,class:"cbox",type:"checkbox","aria-checked":"false"})),h.append(i),j=0;j<labels.length;j++)h.append($("<td/>").text(d[e][labels[j]]));g.append(h)}}$("#popup table").append(g),$("#popup thead").append(f),$("#popup").modal({backdrop:"static",keyboard:!1}).on("shown.bs.modal",function(){$(this).find(".modal-dialog").css({"max-width":50+$("#forecastexporttable").width()+"px",visibility:"visible"})}).modal("show"),$("#button_export").on("click",function(){d=[];var b=[],e={},f=$("#forecastexporttable tr.selected");$.each(f,function(a,c){b=c.children,e.id=b[1].textContent,e.type=b[2].textContent,e.item=b[3].textContent,e.value=b[4].textContent,e.quantity=b[5].textContent,e.location=b[6].textContent,e.origin=b[7].textContent,e.startdate=b[8].textContent,e.enddate=b[9].textContent,e.criticality=b[10].textContent,d.push(e)}),$("#popup .modal-body").html(gettext("connecting")+"..."),$.ajax({url:url_prefix+"/erp/upload/",data:JSON.stringify(d),type:"POST",contentType:"application/json",success:function(){$("#popup .modal-body").html(gettext("Export successful")),$("#cancelbutton").val(gettext("Close")),$("#button_export").toggleClass("btn-primary").prop("disabled",!0);for(var b in c){"proposed"==a.jqGrid("getCell",c[b],"status")&&a.jqGrid("setCell",c[b],"status","approved")}},error:function(a,b,c){fmts=ngettext("Error during export"),$("#popup .modal-title").addClass("alert alert-danger").html(gettext("Error during export")),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+a.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")}})}),$("#cb_modaltableall").click(function(){$("#forecastexporttable input[type=checkbox]").prop("checked",$(this).prop("checked")),$("#forecastexporttable tbody tr").toggleClass("selected"),
$("#forecastexporttable tbody input[type=checkbox]:checked").length>0?$("#button_export").removeClass("active").addClass("active").prop("disabled",!1):$("#button_export").removeClass("active").prop("disabled",!0)}),$("#forecastexporttable tbody input[type=checkbox]").click(function(){$(this).parent().parent().toggleClass("selected"),$("#cb_modaltableall").prop("checked",0==$("#forecastexporttable tbody input[type=checkbox]:not(:checked)").length),$("#forecastexporttable tbody input[type=checkbox]:checked").length>0?$("#button_export").removeClass("active").addClass("active").prop("disabled",!1):$("#button_export").removeClass("active").prop("disabled",!0)}),$("#actions1").html($("#actionsul").children().first().text()+'  <span class="caret"></span>')},error:function(a,b,c){fmts=gettext("Error getting data"),$("#popup .modal-title").addClass("alert alert-danger").html(fmts),$("#popup .modal-body").css({"overflow-y":"auto"}).html('<div style="overflow-y:auto; height: 300px; resize: vertical">'+a.responseText+"</div>"),$("#button_export").val(gettext("Retry")),$("#popup .modal-dialog").css({visibility:"visible"}),$("#popup").modal("show")}})}}}},dashboard={dragAndDrop:function(){$(".cockpitcolumn").each(function(){Sortable.create($(this)[0],{group:"widgets",handle:".panel-heading",animation:100,onEnd:function(a){dashboard.save()}})}),$("#workarea").each(function(){Sortable.create($(this)[0],{group:"cockpit",handle:"h1",animation:100,onEnd:function(a){dashboard.save()}})}),$(".panel-toggle").click(function(){var a=$(this);a.toggleClass("fa-minus fa-plus"),a.closest(".panel").find(".panel-body").toggle()}),$(".panel-close").click(function(){$(this).closest(".panel").remove(),dashboard.save()})},save:function(a){var b=[];if($("[data-cockpit-row]").each(function(){var a=$(this).attr("data-cockpit-row"),c=[];$(".cockpitcolumn",this).each(function(){var a=12;$(this).hasClass("col-md-12")?a=12:$(this).hasClass("col-md-11")?a=11:$(this).hasClass("col-md-10")?a=10:$(this).hasClass("col-md-9")?a=9:$(this).hasClass("col-md-8")?a=8:$(this).hasClass("col-md-7")?a=7:$(this).hasClass("col-md-6")?a=6:$(this).hasClass("col-md-5")?a=5:$(this).hasClass("col-md-4")?a=4:$(this).hasClass("col-md-3")?a=3:$(this).hasClass("col-md-2")&&(a=2);var b=[];$("[data-cockpit-widget]",this).each(function(){b.push([$(this).attr("data-cockpit-widget"),{}])}),c.push({width:a,widgets:b})}),c.length>0&&b.push({rowname:a,cols:c})}),"undefined"!=typeof url_prefix)var c=url_prefix+"/settings/";else var c="/settings/";$.ajax({url:c,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({"freppledb.common.cockpit":b}),success:function(){"string"===$.type(a)&&(window.location.href=window.location.href)},error:function(a,b,c){$("#popup").html('<div class="modal-dialog" style="width: auto"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true" class="fa fa-times"></span></button><h4 class="modal-title">'+gettext("Error saving report settings")+'</h4></div><div class="modal-body"><p>'+a.responseText+"  "+b+c+'</p></div><div class="modal-footer"></div></div></div>').modal("show")}})},customize:function(a){var b="";$("[data-cockpit-row='"+a+"'] .cockpitcolumn").each(function(){""!=b&&(b+=" - "),$(this).hasClass("col-md-12")?b+="100%":$(this).hasClass("col-md-11")?b+="92%":$(this).hasClass("col-md-10")?b+="83%":$(this).hasClass("col-md-9")?b+="75%":$(this).hasClass("col-md-8")?b+="67%":$(this).hasClass("col-md-7")?b+="58%":$(this).hasClass("col-md-6")?b+="50%":$(this).hasClass("col-md-5")?b+="42%":$(this).hasClass("col-md-4")?b+="33%":$(this).hasClass("col-md-3")?b+="25%":$(this).hasClass("col-md-2")&&(b+="17%")});for(var c='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+gettext("Customize a dashboard row")+'</h4></div><div class="modal-body"><form class="form-horizontal"><div class="form-group"><label class="col-md-3 control-label" for="id_name">'+gettext("Name")+':</label><div class="col-md-9"><input id="id_name" class="form-control" type="text" value="'+a+'"></div></div><div class="form-group"><label class="col-md-3 control-label" for="id_layout2">'+gettext("Layout")+':</label><div class="col-md-9 dropdown dropdown-submit-input"><button class="btn btn-default dropdown-toggle" id="id_layout2" name="layout" type="button" data-toggle="dropdown" aria-haspopup="true"><span id="id_layout">'+b+'</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="id_layout" id="id_layoutul"><li class="dropdown-header">'+gettext("Single column")+'</li><li><a onclick="dashboard.setlayout(this)">100%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Two columns")+'</li><li><a onclick="dashboard.setlayout(this)">75% - 25%</a></li><li><a onclick="dashboard.setlayout(this)">67% - 33%</a></li><li><a onclick="dashboard.setlayout(this)">50% - 50%</a></li><li><a onclick="dashboard.setlayout(this)">33% - 67%</a></li><li><a onclick="dashboard.setlayout(this)">25% - 75%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Three columns")+'</li><li><a onclick="dashboard.setlayout(this)">50% - 25% - 25%</a></li><li><a onclick="dashboard.setlayout(this)">33% - 33% - 33%</a></li><li class="divider"></li><li class="dropdown-header">'+gettext("Four columns")+'</li><li><a onclick="dashboard.setlayout(this)">25% - 25% - 25% - 25%</a></li></ul></div></div><div class="form-group"><label class="col-md-3 control-label" for="id_widget2">'+gettext("Add widget")+':</label><div class="col-md-9 dropdown dropdown-submit-input"><button class="btn btn-default dropdown-toggle" id="id_widget2" type="button" data-toggle="dropdown"><span id="id_widget">-</span>&nbsp;<span class="caret"></span></button><ul class="dropdown-menu col-sm-9" aria-labelledby="id_widget2" id="id_widgetul">',d=hiddenwidgets.length,e=0;e<d;e++)c+='<li><a onclick="dashboard.setwidget('+e+')">'+hiddenwidgets[e][1]+"</a></li>";c+='</ul></div><span id="newwidgetname" style="display:none"></span></div></form></div><div class="modal-footer"><input type="submit" role="button" onclick=\'dashboard.saveCustomization("'+a+'")\' class="btn btn-danger pull-left" value="'+gettext("Save")+'"><input type="submit" role="button" onclick=\'dashboard.deleteRow("'+a+'")\' class="btn btn-danger pull-left" value="'+gettext("Delete")+'"><input type="submit" role="button" onclick=\'$("#popup").modal("hide")\' class="btn btn-primary pull-right" data-dismiss="modal" value="'+gettext("Cancel")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+a+'", false)\' class="btn btn-primary pull-right" value="'+gettext("Add new below")+'"><input type="submit" role="button" onclick=\'dashboard.addRow("'+a+'", true)\' class="btn btn-primary pull-right" value="'+gettext("Add new above")+'"></div></div></div></div>',$("#popup").html(c).modal("show")},setlayout:function(a){$("#id_layout").text($(a).text())},setwidget:function(a){$("#id_widget").text(hiddenwidgets[a][1]),$("#newwidgetname").text(hiddenwidgets[a][0])},saveCustomization:function(a){var b=$("#id_name").val();if(a!=b){for(var c=2;$("[data-cockpit-row='"+b+"']").length>1;)b=$("#id_name").val()+" - "+c++;$("[data-cockpit-row='"+a+"'] .col-md-11 h1").text(b),$("[data-cockpit-row='"+a+"'] h1 button").attr("onclick","dashboard.customize('"+b+"')"),$("[data-cockpit-row='"+a+"'] .horizontal-form").attr("id",b),$("[data-cockpit-row='"+a+"']").attr("data-cockpit-row",b)}var d=$("#id_layout").text().split("-"),e=0,f=null;for($("[id='"+a+"'] .cockpitcolumn").each(function(){e<d.length?(f=this,$(this).removeClass("col-md-1 col-md-2 col-md-3 col-md-4 col-md-5 col-md-6 col-md-7 col-md-8 col-md-9 col-md-10 col-md-11 col-md-12"),$(this).addClass("col-md-"+Math.round(.12*parseInt(d[e])))):($("[data-cockpit-widget]",this).appendTo(f),$(this).remove()),e++});e<d.length;)f=$('<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(d[e]))+' col-sm-12"></div>').insertAfter(f),e++;var g=$("#newwidgetname").text();""!=g?($('<div class="panel panel-default" data-cockpit-widget="'+g+'"></div>').appendTo(f),dashboard.save("true")):dashboard.save(),dashboard.dragAndDrop(),$("#popup").modal("hide")},deleteRow:function(a){$("[data-cockpit-row='"+a+"']").remove(),dashboard.save(),$("#popup").modal("hide")},addRow:function(a,b){for(var c=$("#id_name").val(),d=2;$("[data-cockpit-row='"+c+"']").length>=1;)c=$("#id_name").val()+" - "+d++;for(var e='<div class="row" data-cockpit-row="'+c+'"><div class="col-md-11"><h1 style="float: left">'+c+'</h1></div><div class="col-md-1"><h1 class="pull-right"><button class="btn btn-xs btn-primary" onclick="dashboard.customize(\''+c+'\')" data-toggle="tooltip" data-placement="top" data-original-title="'+gettext("Customize")+'"><span class="fa fa-wrench"></span></button></h1></div><div class="horizontal-form" id="'+c+'">',f=$("#id_layout").text().split("-"),g=$("#newwidgetname").text(),h=0;h<f.length;h++)e+='<div class="cockpitcolumn col-md-'+Math.round(.12*parseInt(f[h]))+' col-sm-12">',0==h&&""!=g&&(e+='<div class="panel panel-default" data-cockpit-widget="'+g+'"></div>'),e+="</div>";e+="</div></div></div>",b?$("[data-cockpit-row='"+a+"']").first().before($(e)):$("[data-cockpit-row='"+a+"']").last().after($(e)),""!=g?dashboard.save("true"):dashboard.save(),dashboard.dragAndDrop(),$("#popup").modal("hide")}},activeButton=null;$(function(){$(".menuButton").click(function(a){var b=$(a.target),c=b.next("div");if(b.blur(),activeButton&&(activeButton.removeClass("menuButtonActive"),activeButton.next("div").css("visibility","hidden")),b!=activeButton){b.addClass("menuButtonActive");var d=b.position();c.css({left:d.left+"px",top:d.top+b.outerHeight()+3+"px",visibility:"visible"}),activeButton=b}else activeButton=null}),$(".menuButton").mouseenter(function(a){null!=activeButton&&activeButton!=$(a.target)&&$(a.target).click()}),$(document).ajaxSend(function(a,b,c){!/^(GET|HEAD|OPTIONS|TRACE)$/.test(c.type)&&sameOrigin(c.url)&&b.setRequestHeader("X-CSRFToken",getToken())}),$.ajaxSetup({cache:!1});var a=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:url_prefix+"/search/?term=%QUERY",wildcard:"%QUERY"}});$("#search").typeahead({minLength:2},{limit:1e3,highlight:!0,name:"search",display:"value",source:a,templates:{suggestion:function(a){return null===a.value?'<span><p style="margin-top: 5px; margin-bottom: 1px;">'+a.label+'</p><li  role="separator" class="divider"></li></span>':'<li><a style="display: block" href="'+url_prefix+a.url+admin_escape(a.value)+'/" >'+a.value+"</a></li>"}}})}),$(document).mousedown(function(a){activeButton&&a.target!=activeButton&&$(a.target).parent(".ui-menu-item").length<1&&(activeButton.removeClass("menuButtonActive"),activeButton.next("div").css("visibility","hidden"),activeButton=null)}),$.fn.bindFirst=function(a,b){this.on(a,b),this.each(function(){var b=$._data(this,"events")[a.split(".")[0]],c=b.pop();b.splice(0,0,c)})};var graph={header:function(a,b){var c=$("#grid_graph");c.html("");var d=b.range(),e=b.rangeBand(),f=d3.select(c.get(0)).append("svg");f.attr("height","15px"),f.attr("width",c.width());var g=0;for(var h in timebuckets){var i=a+d[h]+e/2;if(g<=i){g=i+f.append("text").attr("class","svgheadertext").attr("x",i).attr("y","12").text(timebuckets[h].name).node().getComputedTextLength()+12}}},showTooltip:function(a){var b=d3.select("#tooltip");b.empty()&&(b=d3.select("body").append("div").attr("id","tooltip").attr("role","tooltip").attr("class","popover fade right in").style("position","absolute")),b.html(""+a).style("display","block"),graph.moveTooltip()},hideTooltip:function(){d3.select("#tooltip").style("display","none"),d3.event.stopPropagation()},moveTooltip:function(){var a=d3.event.pageX+5,b=d3.event.pageY-28,c=$(window).width()-$("#tooltip").width()-20,d=$(window).height()-$("#tooltip").height()-20;a>c&&(a=c,b=d3.event.pageY+5),b>d&&(b=d3.event.pageY-$("#tooltip").height()-25),d3.select("#tooltip").style({left:a+"px",top:b+"px"}),d3.event.stopPropagation()},miniAxis:function(a){var b=this.scale().range(),c=this.scale().domain();a.append("path").attr("class","domain").attr("d","M-10 0 H0 V"+(b[0]-2)+" H-10"),a.append("text").attr("x",-2).attr("y",13).attr("text-anchor","end").text(Math.round(c[1],0)),a.append("text").attr("x",-2).attr("y",b[0]-5).attr("text-anchor","end").text(Math.round(c[0],0))}},gantt={startmousemove:null,resizing:null,rowsize:25,header:function(){var a=864e5/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width(),b=['<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="34px">','<line class="time" x1="0" y1="17" x2="'+$("#jqgh_grid_operationplans").width()+'" y2="17"/>'],c=0;if(a<5)for(var d=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);d<viewend;){var e=(d.getTime()-viewstart.getTime())/864e5*a,f=new Date(d.getFullYear(),d.getMonth()+1,1),g=(f.getTime()-viewstart.getTime())/864e5*a;if(b.push('<text class="svgheadertext" x="'+Math.floor((e+g)/2)+'" y="31">'+moment(d).format("MMM")+"</text>"),d.getMonth()%3==0){var h=new Date(d.getFullYear(),d.getMonth()+3,1);g=(h.getTime()-viewstart.getTime())/864e5*a;var i=Math.floor((d.getMonth()+3)/3);b.push('<line class="time" x1="'+Math.floor(e)+'" y1="0" x2="'+Math.floor(e)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor((e+g)/2)+'" y="13">'+d.getFullYear()+" Q"+i+"</text>")}else b.push('<line class="time" x1="'+Math.floor(e)+'" y1="17" x2="'+Math.floor(e)+'" y2="34"/>');d=f}else if(a<10){c-=viewstart.getDay()*a;for(var d=new Date(viewstart.getTime()-864e5*viewstart.getDay());d<viewend;)b.push('<line class="time" x1="'+Math.floor(c)+'" y1="17" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+3.5*a)+'" y="31">'+moment(d).format("MM-DD")+"</text>"),c+=7*a,d.setTime(d.getTime()+6048e5);for(d=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);d<viewend;)e=(d.getTime()-viewstart.getTime())/864e5*a,f=new Date(d.getFullYear(),d.getMonth()+1,1),g=(f.getTime()-viewstart.getTime())/864e5*a,b.push('<line class="time" x1="'+Math.floor(e)+'" y1="0" x2="'+Math.floor(e)+'" y2="17"/>'),b.push('<text class="svgheadertext" x="'+Math.floor((e+g)/2)+'" y="13">'+moment(d).format("MMM YY")+"</text>"),d=f}else if(a<20){c-=viewstart.getDay()*a;for(var d=new Date(viewstart.getTime()-864e5*viewstart.getDay());d<viewend;)b.push('<line class="time" x1="'+Math.floor(c)+'" y1="17" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+(c+7*a/2)+'" y="31">'+moment(d).format("YY-MM-DD")+"</text>"),c+=7*a,d.setTime(d.getTime()+6048e5);for(d=new Date(viewstart.getFullYear(),viewstart.getMonth(),1);d<viewend;)e=(d.getTime()-viewstart.getTime())/864e5*a,f=new Date(d.getFullYear(),d.getMonth()+1,1),g=(f.getTime()-viewstart.getTime())/864e5*a,b.push('<line class="time" x1="'+Math.floor(e)+'" y1="0" x2="'+Math.floor(e)+'" y2="17"/>'),b.push('<text class="svgheadertext" x="'+Math.floor((e+g)/2)+'" y="13">'+moment(d).format("MMM YY")+"</text>"),d=f}else if(a<=40)for(var d=new Date(viewstart.getTime());d<viewend;)0==d.getDay()?(b.push('<line class="time" x1="'+Math.floor(c)+'" y1="0" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+7*a/2)+'" y="13">'+moment(d).format("YY-MM-DD")+"</text>")):b.push('<line class="time" x1="'+Math.floor(c)+'" y1="17" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+a/2)+'" y="31">'+moment(d).format("DD")+"</text>"),c+=a,d.setDate(d.getDate()+1);else if(a<=75)for(var d=new Date(viewstart.getTime());d<viewend;)0==d.getDay()?(b.push('<line class="time" x1="'+Math.floor(c)+'" y1="0" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+7*a/2)+'" y="13">'+moment(d).format("YY-MM-DD")+"</text>")):b.push('<line class="time" x1="'+Math.floor(c)+'" y1="17" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+a/2)+'" y="31">'+moment(d).format("DD MM")+"</text>"),c+=a,d.setDate(d.getDate()+1);else if(a<350)for(var d=new Date(viewstart.getTime());d<viewend;)0==d.getDay()?(b.push('<line class="time" x1="'+Math.floor(c)+'" y1="0" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+3.5*a)+'" y="13">'+moment(d).format("YY-MM-DD")+"</text>")):b.push('<line class="time" x1="'+Math.floor(c)+'" y1="17" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+a/2)+'" y="31">'+moment(d).format("ddd DD MMM")+"</text>"),c+=a,d.setDate(d.getDate()+1);else for(var d=new Date(viewstart.getTime());d<viewend;)0==d.getHours()?(b.push('<line class="time" x1="'+Math.floor(c)+'" y1="0" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+a/2)+'" y="13">'+moment(d).format("ddd YY-MM-DD")+"</text>")):b.push('<line class="time" x1="'+Math.floor(c)+'" y1="17" x2="'+Math.floor(c)+'" y2="34"/>'),b.push('<text class="svgheadertext" x="'+Math.floor(c+a/48)+'" y="31">'+d.getHours()+"</text>"),c+=a/24,d.setTime(d.getTime()+36e5);b.push("</svg>"),$("#jqgh_grid_operationplans").html(b.join("")).unbind("mousedown").bind("mousedown",function(a){gantt.startmousemove=a.pageX,$(window).bind("mouseup",function(a){$(window).unbind("mousemove"),$(window).unbind("mouseup"),a.stopPropagation()}),$(window).bind("mousemove",function(a){var b=a.pageX-gantt.startmousemove;Math.abs(b)>3&&(gantt.zoom(1,b>0?-864e5:864e5),gantt.startmousemove=a.pageX),a.stopPropagation()}),a.stopPropagation()})},reset:function(){var a=$("#jqgh_grid_operationplans").width()/1e4;viewstart=new Date(horizonstart.getTime()),viewend=new Date(horizonend.getTime()),$(".transformer").each(function(){var b=$(this).attr("title");$(this).attr("transform","scale("+a+",1) translate(0,"+((b-1)*gantt.rowsize+3)+")")}),gantt.header()},redraw:function(){var a=(horizonend.getTime()-horizonstart.getTime())/(viewend.getTime()-viewstart.getTime())*$("#jqgh_grid_operationplans").width()/1e4;$(".transformer").each(function(){var b=$(this).attr("title");$(this).attr("transform","scale("+a+",1) translate(0,"+((b-1)*gantt.rowsize+3)+")")}),gantt.header()},zoom:function(a,b){var c=Math.min(1095,Math.max(1,Math.ceil((viewend.getTime()-viewstart.getTime())/864e5*a)));viewstart.setTime(viewstart.getTime()+b),viewend.setTime(viewstart.getTime()+864e5*c);var d=(horizonend.getTime()-horizonstart.getTime())/(864e6*c)*$("#jqgh_grid_operationplans").width()/1e3,e=(horizonstart.getTime()-viewstart.getTime())/(horizonend.getTime()-horizonstart.getTime())*1e4;$(".transformer").each(function(){var a=$(this).attr("title");$(this).attr("transform","scale("+d+",1) translate("+e+","+((a-1)*gantt.rowsize+3)+")")}),gantt.header()}},tour={autoplay:0,tooltip:null,chapter:0,step:0,intro:null,timeout:null,tooltip:'<div class="popover tourpopover" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>',introtip:'<div class="popover tourpopover" role="tooltip"><div class="arrow"></div><div class="popover-content" style="padding-bottom: 0"></div><div class="popover-footer small"><label><input style="vertical-align: bottom" type="checkbox" checked onclick="tour.displayHints(this.checked, true)">&nbsp;'+gettext("Show hints")+"</label></div></div>",displayHints:function(a,b){a?(localStorage.removeItem("intro"),$("#showHints").addClass("toggle-on").removeClass("toggle-off"),tour.showIntroPage(null)):(localStorage.setItem("intro","{}"),$("#showHints").addClass("toggle-off").removeClass("toggle-on"),$(".tourpopover").popover("destroy"))},showIntroPage:function(a){if(null==a){var b={};for(var c in introdata)b[c]=0;localStorage.setItem("intro",JSON.stringify(b))}else{""==a&&(a=localStorage.getItem("intro"));var b=JSON.parse(a)}location.pathname in b?(tour.intro=introdata[location.pathname][b[location.pathname]],tour.showStep(),tour.intro=null,$("html").on("click",function(a){$(a.target).is("a")||tour.showIntroPage("")}),b[location.pathname]+=1,b[location.pathname]>=introdata[location.pathname].length&&delete b[location.pathname],localStorage.setItem("intro",JSON.stringify(b))):$(".tourpopover").popover("destroy")},start:function(a){var b=a.split(",");tour.chapter=parseInt(b[0]),tour.step=parseInt(b[1]),tour.autoplay=parseInt(b[2]),jQuery.ajax({url:"/static/js/i18n/tour.en.js",dataType:"script",cache:!0}).success(tour.init).fail(function(){console.log("Error loading the tutorial: "+arguments[2].toString())})},init:function(){$("#timebuckets").modal("hide"),$.jgrid.hideModal("#searchmodfbox_grid"),$("#popup").removeClass("in").addClass("tourguide").html('<div class="modal-dialog" id="tourModal" role="dialog" style="width: 390px; position: absolute; bottom: 10px; left: auto; right: 15px;"><div class="modal-content"><div class="modal-header"><h4 id="modalTitle" class="modal-title"><strong>'+gettext("Guided tour")+'</strong><button type="button" id="tourcancelbutton" class="close" data-dismiss="modal" aria-hidden="true"><span class="fa fa-times"</button></h4></div><div class="modal-body" id="tourmodalbody" style="padding-bottom:20px;">'+tourdata[tour.chapter].description+'</div><div class="modal-footer"><div class="btn-group control-form" role="group" aria-label="tour buttons"><button type="submit" id="tourprevious" role="button" class="btn btn-primary"><span class="fa fa-step-backward"></span>&nbsp;'+gettext("Previous")+'</button><button type="submit" id="playbutton" role="button" class="btn btn-primary">'+gettext(0===tour.autoplay?"Play":"Pause")+"&nbsp;<span class= "+(0===tour.autoplay?'"fa fa-play"':'"fa fa-pause"')+'></span></button><button type="submit" id="tournext" role="button" class="btn btn-primary">'+gettext("Next")+'&nbsp;<span class="fa fa-step-forward"></span></button></div></div></div></div>').modal({}).on("hidden.bs.modal",function(){$(".tourpopover").popover("destroy")}).on("shown.bs.modal",function(){tour.showStep()}).modal("show"),$("#tourmodalbody").append('<div id="tour" style="padding-bottom:20px; display:none">'+tourdata[tour.chapter].description+"<br><br><br></div>"),$("#tourprevious").on("click",function(){tour.prev()}),$("#playbutton").on("click",function(){tour.toggleAutoplay()}),$("#tournext").on("click",function(){tour.next()}),$("#tourcancelbutton").on("click",function(){$(".tourpopover").popover("destroy"),$("#tourModal").modal("hide")})},next:function(){$(tourdata[tour.chapter].steps[tour.step].element).popover("destroy"),tour.step++,tour.step>=tourdata[tour.chapter].steps.length&&(tour.chapter++,tour.step=0,tour.chapter>=tourdata.length&&(tour.chapter=0)),tour.showStep()},prev:function(){if($(tourdata[tour.chapter].steps[tour.step].element).popover("destroy"),--tour.step<0){if(--tour.chapter<0)return tour.step=0,void(tour.chapter=0);tour.step=tourdata[tour.chapter].steps.length-1}tour.showStep()},showStep:function(){if($(".tourpopover").popover("destroy"),tour.intro)var stepData=tour.intro;else{var stepData=tourdata[tour.chapter].steps[tour.step],nexthref="",currsearch="";if(currsearch=location.search.lastIndexOf("&")>-1?location.search.replace(location.search.slice(location.search.lastIndexOf("&")),""):"",location.pathname+currsearch!=url_prefix+stepData.url)return nexthref=url_prefix+stepData.url+"?tour="+tour.chapter+","+tour.step+","+tour.autoplay,2==nexthref.match(/\?/g).length&&(nexthref=url_prefix+stepData.url+"&tour="+tour.chapter+","+tour.step+","+tour.autoplay),void(window.location.href=nexthref)}"beforestep"in stepData&&eval(stepData.beforestep);var tooltipPos=void 0===stepData.position?"BL":stepData.position;$(stepData.element).attr("role","button").attr("tabindex","0"),$(stepData.element).popover({html:!0,container:"body",template:tour.intro?tour.introtip:tour.tooltip,title:"",content:stepData.description,placement:stepData.position,trigger:"manual"}),$(stepData.element).popover("show").on("shown.bs.popover",function(){var a=$(".tourpopover").css("top").replace("px","");(a<window.pageYOffset||a>window.pageYOffset+window.innerHeight/2)&&window.scrollTo(0,a-window.innerHeight/2)}),null==tour.intro&&($("#tourmodalbody").html(tourdata[tour.chapter].description),0==tour.chapter&&0==tour.step?$("#tourprevious").prop("disabled",!0):$("#tourprevious").prop("disabled",!1),tour.chapter>=tourdata.length-1&&tour.step>=tourdata[tour.chapter].steps.length-1?$("#tournext").prop("disabled",!0):$("#tournext").prop("disabled",!1),tour.autoplay&&(tour.timeout=setTimeout(tour.next,1e3*tourdata[tour.chapter].delay))),"afterstep"in stepData&&eval(stepData.afterstep)},toggleAutoplay:function(){tour.autoplay>0?($("#playbutton").html(gettext("Play")+'&nbsp;<span class="fa fa-play"></span>'),tour.autoplay=0,clearTimeout(tour.timeout),tour.timeout=null):($("#playbutton").html(gettext("Pause")+'&nbsp;<span class="fa fa-pause"></span>'),tour.autoplay=1,tour.next())}};
//# sourceMappingURL=frepple.min.js.map