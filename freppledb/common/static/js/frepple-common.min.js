/* frePPLe 4.0.0 2018-08-22
Copyright (C) 2010-2017 by frePPLe bvba

This library is free software; you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published
by the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero
General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

function webfactory(a,b,c){"use strict";function d(b,c){var d=a.$on("websocket-"+b,function(a,b){c(b)});a.$on("$destroy",d)}function e(a){g.readyState>1&&(g=b(service_url)),f&&console.log("send:"+a),g.send(a)}var f=!0,g=b(service_url,{reconnectIfNotNormalClose:!0});return c(function(){g.send("/alive/")},6e5),g.onMessage(function(b){var c=angular.fromJson(b.data);f&&console.log(c),a.$broadcast("websocket-"+c.category,c)}),g.onError(function(a){a="<p>Websocket connection is not working.</p><p>Please check that <strong>plan.webservice</strong> parameter is set to <strong>true</strong>,<br>and <strong>execute the plan</strong>.</p>",angular.element("#controller").scope().databaseerrormodal=!0,angular.element("#controller").scope().$apply(),angular.element(document).find("#popup2 .modal-title span").html("Websocket connection problem"),angular.element(document).find(".modal-body").html('<div style="width: 100%; overflow: auto;">'+a+"</div>"),angular.element(document).find("#popup2").modal("show"),angular.element("#controller").scope().$apply()}),{send:e,subscribe:d}}function PreferenceSvc(a){"use strict";function b(b,c,f){"object"==typeof b&&b.length===c.length?angular.forEach(b,function(a,b){e[a]=c[b]}):e[b]=c;var g="/"+angular.element(document).find("#database").attr("name");"/default"!==g&&"/undefined"!==g||(g="");var h={};h[d]=e,a.post(g+"/settings/",angular.toJson(h)).then(function(a){"function"==typeof f&&f(a)},function(a){angular.element(document).find(".modal-body").html('<div style="width: 100%; overflow: auto;">'+a.data+"</div>"),angular.element(document).find("#popup2").modal("show")})}function c(a,b){return a in e?e[a]:b}var d="freppledb.planningboard",e=preferences;return e=void 0!==e&&"None"!==e?angular.fromJson(preferences):{},{get:c,save:b}}function chatScreen(a,b){return{restrict:"EA",scope:{label:"@",onClick:"&"},template:'<div class="pannel" id="chat-panel" style="max-width: 700px;"><div class="pannel-body"><div  style="height: 200px; overflow-y: scroll;"><table class="table" id="chathistory"></table></div></div><div class="panel-footer"><form><div class="input-group"><input id="chatmsg" type="text" class="form-control" size="80"><span class="input-group-btn"><button class="btn btn-primary pull-right" id="chatsend" ng-click="sendChat()">send</button></span></div></div></form></div>',link:function(a,c,d){var e=a.$on("websocket-chat",function(b,c){a.displayChat(c)});a.$on("$destroy",e),a.displayChat=function(a){var b=angular.element(document).find("#chathistory");$(a.messages).each(function(){b.append($("<tr>").append($('<td style="white-space: nowrap;">').text(this.date.replace("T"," "))).append($('<td style="white-space: nowrap;">').text(this.name)).append($('<td style="white-space: wrap;">').text(this.value)))}),b=b.parent(),b.scrollTop(b.prop("scrollHeight"))},a.sendChat=function(){var a=angular.element(document).find("#chatmsg");""!==a.val()&&(b.send("/chat/"+a.val()),a.val(""))}}}}angular.module("frepple.common",[]),angular.module("frepple.common").constant("getURLprefix",function(){return"default"===database?"":"/"+database}),angular.module("frepple.common").filter("dateTimeFormat",function(){return function(a,b){return b=b||"YYYY-MM-DD HH:mm:ss",a?a.format(b):""}}),angular.module("frepple.common").factory("WebSvc",webfactory),webfactory.$inject=["$rootScope","$websocket","$interval"],angular.module("frepple.common").service("PreferenceSvc",PreferenceSvc),PreferenceSvc.$inject=["$http"],angular.module("frepple.common").directive("chatScreen",chatScreen),chatScreen.$inject=["$window","WebSvc"];
//# sourceMappingURL=frepple-common.min.js.map